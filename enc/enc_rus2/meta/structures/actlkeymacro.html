<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>ActlKeyMacro</title>
<meta http-equiv="Content-Type" Content="text/html; charset=Windows-1251">
<link rel="stylesheet" type="text/css" href="../../styles/styles.css">
</head>
<body>

<h1>ActlKeyMacro</h1>
<div class=navbar>
<a href="../index.html">главная</a> |
<a  href="index.html">структуры</a><br>
</div>

<div class=shortdescr>
Структура <dfn>ActlKeyMacro</dfn> используется в функции
<a href="../service_functions/advcontrol.html">AdvControl</a>
для операций с макрокомандами.
</div>

<pre class=syntax>
struct ActlKeyMacro {
  int Command;
  union{
    struct {
      const wchar_t *SequenceText;
      DWORD Flags;
    } PlainText;
    struct MacroParseResult MacroResult;
    DWORD_PTR Reserved[3];
  } Param;
};
</pre>
<h3>Элементы</h3>
<div class=descr>

    <div class=dfn>Command</div>
    <div class=dfndescr>Одна из команд (перечисление <a name="FARMACROCOMMAND">FARMACROCOMMAND</a>):
<table class="cont">
<tr class="cont"><th class="cont" width="40%">Команда</th><th class="cont" width="60%">Описание</th></tr>

<tr class="cont"><td class="cont" width="40%"><a name="MCMD_LOADALL">MCMD_LOADALL</a></td>
<td class="cont" width="60%">Считать из реестра в память FAR все макросы с затиранием предыдущих значений.
</td></tr>

<tr class="cont"><td class="cont" width="40%"><a name="MCMD_POSTMACROSTRING">MCMD_POSTMACROSTRING</a></td>
<td class="cont" width="60%">Передать в FAR макрос в текстовом виде (в том виде, как их хранит FAR Manager в реестре).<br>
Функция <a href="../service_functions/advcontrol.html">AdvControl</a> возвращает TRUE - макрос проанализирован и
помещены в очередь, и FALSE - ошибка (макропоследовательность содержит ошибки). Макропоследовательность начнет
исполняться тогда, когда FAR получит управление.
</td></tr>

<tr class="cont"><td class="cont" width="40%"><a name="MCMD_SAVEALL">MCMD_SAVEALL</a></td>
<td class="cont" width="60%">Принудительное сохранение макросов из памяти FAR в реестр.</td></tr>

<tr class="cont"><td class="cont" width="40%"><a name="MCMD_GETSTATE">MCMD_GETSTATE</a></td>
<td class="cont" width="60%">Получить статус работы макродвижка.<br>Возвращает одно из значений (перечисление <a name="FARMACROSTATE">FARMACROSTATE</a>):
  <table class="cont">
    <tr class="cont"><th class="cont" width="40%">Значение</th><th class="cont" width="60%">Описание</th></tr>
    <tr class="cont"><td class="cont" width="40%"><a name="MACROSTATE_NOMACRO">MACROSTATE_NOMACRO</a></td>
    <td class="cont" width="60%">макродвижок не выполняет ни какой макрос в текущий момент</td></tr>
    <tr class="cont"><td class="cont" width="40%"><a name="MACROSTATE_EXECUTING">MACROSTATE_EXECUTING</a></td>
    <td class="cont" width="60%">идет исполнение макроса без передачи кодов клавиш в плагин</td></tr>
    <tr class="cont"><td class="cont" width="40%"><a name="MACROSTATE_EXECUTING_COMMON">MACROSTATE_EXECUTING_COMMON</a></td>
    <td class="cont" width="60%">идет исполнение макроса; коды клавиш в плагин передаются</td></tr>
    <tr class="cont"><td class="cont" width="40%"><a name="MACROSTATE_RECORDING">MACROSTATE_RECORDING</a></td>
    <td class="cont" width="60%">идет запись макроса без передачи кодов клавиш в плагин</td></tr>
    <tr class="cont"><td class="cont" width="40%"><a name="MACROSTATE_RECORDING_COMMON">MACROSTATE_RECORDING_COMMON</a></td>
    <td class="cont" width="60%">идет запись макроса; коды клавиш в плагин передаются</td></tr>
  </table>
  Компонента <em>Param</em> игнорируется. Значение возвращается функцией <a href="../service_functions/advcontrol.html">AdvControl</a>.

</td></tr>

<tr class="cont"><td class="cont" width="40%"><a name="MCMD_CHECKMACRO">MCMD_CHECKMACRO</a></td>
<td class="cont" width="60%">Проверяет макропоследовательность Param.PlainText.SequenceText и возвращает результат в Param.MacroResult
(структура <a href="macroparseresult.html">MacroParseResult</a>). Содержимое Param.PlainText затирается.
</td></tr>


</table>
    </div>
    <div class=dfn>Param.PlainText.SequenceText</div>
    <div class=dfndescr>Указатель на строку, содержащую макрос в текстовом виде.
     Этот член структуры используется для команды <dfn>MCMD_POSTMACROSTRING</dfn>.
    </div>

    <div class=dfn>Param.PlainText.Flags</div>
    <div class=dfndescr>Комбинация флагов исполнения макропоследовательности (перечисление <a name="FARKEYSEQUENCEFLAGS">FARKEYSEQUENCEFLAGS</a>):
<table class="cont">
<tr class="cont"><th class="cont" width="40%">Флаг</th><th class="cont" width="60%">Описание</th></tr>
       <tr class="cont"><td class="cont" width="40%"><a name="KSFLAGS_DISABLEOUTPUT">KSFLAGS_DISABLEOUTPUT</a></td>
       <td class="cont" width="60%">Не отображать на экране результат работы каждой клавиши.</td></tr>
       <tr class="cont"><td class="cont" width="40%"><a name="KSFLAGS_NOSENDKEYSTOPLUGINS">KSFLAGS_NOSENDKEYSTOPLUGINS</a></td>
       <td class="cont" width="60%">Не передавать клавиши редакторным плагинам (плагинам, экспортирующим
        функцию <a href="../exported_functions/processeditorinputw.html">ProcessEditorInputW</a>).</td></tr>
       <tr class="cont"><td class="cont" width="40%"><a name="KSFLAGS_REG_MULTI_SZ">KSFLAGS_REG_MULTI_SZ</a></td>
       <td class="cont" width="60%">Параметр <em>Param.PlainText.SequenceText</em> представлен в формате <dfn>REG_MULTI_SZ</dfn>.<br>REG_MULTI_SZ в реестре:
<pre class=code>строка 1\x00
строка 2\x00
...
строка N\x00
\x00</pre>

       </td>
       </tr>

       <tr class="cont"><td class="cont" width="40%"><a name="KSFLAGS_SILENTCHECK">KSFLAGS_SILENTCHECK</a></td>
       <td class="cont" width="60%">Не отображать на экране результат проверки макропоследовательности.</td></tr>


</table>
     Этот член структуры используется для команды <dfn>MCMD_POSTMACROSTRING</dfn>.
    </div>

    <div class=dfn>Reserved</div>
    <div class=dfndescr>Зарезервировано.</div>

</div>

<h3>Замечания</h3>
<div class=descr>
<ol>
<li>Команды <dfn>MCMD_LOADALL</dfn> и <dfn>MCMD_SAVEALL</dfn> не будут исполняться во время записи или "проигрывания" макроса.</li>
<li>Флаг <dfn>KSFLAGS_REG_MULTI_SZ</dfn> можно не указывать, если в <em>Param.PlainText.SequenceText</em> вместо 0x00 будут стоять '\n'.
</ol>
</div>

<h3>Пример</h3>
<div class=descr>
Использование <dfn>MCMD_POSTMACROSTRING</dfn> в плагине FARCmds:
<pre class=code>command.Command=MCMD_POSTMACROSTRING;
command.Param.PlainText.SequenceText=(wchar_t *)malloc(wcslen(pCmd)+1);
if(command.Param.PlainText.SequenceText)
{
  command.Param.PlainText.Flags=KSFLAGS_DISABLEOUTPUT;
  wcscpy(command.Param.PlainText.SequenceText,pCmd);
  Info.AdvControl(Info.ModuleNumber,ACTL_KEYMACRO,&amp;command);
  free(command.Param.PlainText.SequenceText);
}
</pre>
Использование <dfn>MCMD_LOADALL</dfn> в плагине FARCmds:
<pre class=code>command.Command=MCMD_LOADALL;
Info.AdvControl(Info.ModuleNumber,ACTL_KEYMACRO,&command);
</pre>
Использование <dfn>MCMD_SAVEALL</dfn> в плагине FARCmds:
<pre class=code>command.Command=MCMD_SAVEALL;
Info.AdvControl(Info.ModuleNumber,ACTL_KEYMACRO,&command);
</pre>

</div>

<div class=see>Смотрите также:</div><div class=seecont>
<a href="index.html">структуры</a> |
<a href="keysequence.html">KeySequence</a> |
</div>

</body>
</html>
