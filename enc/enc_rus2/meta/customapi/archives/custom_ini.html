<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>Формат файла custom.ini</title>
<meta http-equiv="Content-Type" Content="text/html; charset=Windows-1251">
<link rel="stylesheet" type="text/css" href="../../../styles/styles.css">
<script language="javascript" src='../../links.js' type="text/javascript"></script>
</head>
<body>

<h1>Формат файла custom.ini</h1>
<div class=navbar>
<a href="../../index.html">главная</a> |
<a href="../index.html">Custom API</a> |
<a href="index.html">поддержка архивов</a>
</div>

<div class=shortdescr>
В стандартной поставке MultiArc идёт ограниченное количество FMT-модулей,
поддерживающих распространённые архиваторы. Среди прочих присутствует
модуль CUSTOM.FMT, который позволяет подключать "недостающие" архиваторы
путём описания формата выводимого архиватором листинга. Для описания формата
предназначен файл CUSTOM.INI.

<p>Каждый добавляемый тип архива описывается в отдельной секции <dfn>[Имя архива]</dfn>,
используемый для имени типа архива. Далее следуют параметры:
</div>


<div class=descr>
<div class=dfn><dfn>TypeName</dfn> (необязательный параметр)</div>
<div class=dfndescr>перекрывает имя формата, определённое в названии секции (оставлен для совместимости)
</div>

<div class=dfn><dfn>ID</dfn> (необязательный параметр)</div>
<div class=dfndescr>идентификатор архива - последовательность двузначных шестнадцатеричных чисел,
разделённые пробелом (например, запись "<code>ID=1a 4a 61 72 1b</code>" - описывает идентификатор JAR-архива)
</div>

<div class=dfn><dfn>IDOnly</dfn> (необязательный параметр)</div>
<div class=dfndescr>"только идентификатор архива". Если равно "1", то расширение файла игнорируется и
тип архива определяется только по полю ID. Если равно "0", то для определения типа архива используется
расширение файла и поле <var>ID</var> (если присутствует в данной секции).
</div>

<div class=dfn><dfn>IDPos</dfn> (необязательный параметр)</div>
<div class=dfndescr>позиция, с которой CUSTOM.FMT начинает искать идентификатор архива (<var>ID</var>).
Если поле не определено, то ID ищется начиная с начала файла. По умолчанию FAR "отдаёт" плагину
на анализ первые 128К данных.
</div>

<div class=dfn><dfn>Extension</dfn></div>
<div class=dfndescr>расширение архива (без точки).
</div>

<div class=dfn><dfn>List</dfn></div>
<div class=dfndescr>команда внешнего архиватора для получения листинга. Имя архива
будет добавлено после этой строки. Например, для поля <code>List="jar32 v -y"</code> будет
сформирована команда: <code>jar32 v -y имя_архива</code>
</div>

<div class=dfn><dfn>Errorlevel</dfn> (необязательный параметр)</div>
<div class=dfndescr>анализ листинга производится только если код завершения архиватора
будет меньше указанного в параметре <dfn>Errorlevel</dfn> числа.
</div>

<div class=dfn><dfn>IgnoreErrors</dfn> (необязательный параметр)</div>
<div class=dfndescr>если не равно 0, то код возврата команд архиватора будет игнорироваться.
Использовать осторожно!
</div>

<div class=dfn><dfn>Start</dfn> (необязательный параметр)</div>
<div class=dfndescr>подстрока, определяющая начало анализа листинга.
Если строка начинается с символа '<code>^</code>', то поиск подстроки ведётся со второго
символа от начала текущей строки листинга.
</div>

<div class=dfn><dfn>End</dfn> (необязательный параметр)</div>
<div class=dfndescr>подстрока, определяющая окончание анализа листинга.
Если строка начинается с символа '<code>^</code>', то поиск подстроки ведётся со второго
символа от начала текущей строки листинга.
</div>

<div class=dfn><dfn>Format0 ... FormatN</dfn></div>
<div class=dfndescr>параметры, описывающие запись для одного элемента архива. Каждый параметр
описывает очередную строку записи, допускающую следующие коды:
<table class="cont">
<tr class="cont"><th class="cont" width="40%">код</th><th class="cont" width="60%">Описание</th></tr>
<tr class="cont"><td class="cont" width="40%">n</td>
<td class="cont" width="60%">имя файла</td></tr>
<tr class="cont"><td class="cont" width="40%">.</td>
<td class="cont" width="60%">remove trailing spaces from file name and append name with dot</td></tr>
<tr class="cont"><td class="cont" width="40%">z</td>
<td class="cont" width="60%">размер файла</td></tr>
<tr class="cont"><td class="cont" width="40%">c</td>
<td class="cont" width="60%">file description</td></tr>
<tr class="cont"><td class="cont" width="40%">p</td>
<td class="cont" width="60%">упакованный размер файла</td></tr>
<tr class="cont"><td class="cont" width="40%">d</td>
<td class="cont" width="60%">день</td></tr>
<tr class="cont"><td class="cont" width="40%">t</td>
<td class="cont" width="60%">месяц</td></tr>
<tr class="cont"><td class="cont" width="40%">TTT</td>
<td class="cont" width="60%">три буквы имени месяца (Jan, Feb, Mar, ...)</td></tr>
<tr class="cont"><td class="cont" width="40%">y</td>
<td class="cont" width="60%">год</td></tr>
<tr class="cont"><td class="cont" width="40%">h</td>
<td class="cont" width="60%">часы</td></tr>
<tr class="cont"><td class="cont" width="40%">H</td>
<td class="cont" width="60%">hours modifier letter (a - a.m. time, p - p.m. time)</td></tr>
<tr class="cont"><td class="cont" width="40%">m</td>
<td class="cont" width="60%">минуты</td></tr>
<tr class="cont"><td class="cont" width="40%">s</td>
<td class="cont" width="60%">секунды</td></tr>
<tr class="cont"><td class="cont" width="40%">a</td>
<td class="cont" width="60%">атрибуты файла</td></tr>
<tr class="cont"><td class="cont" width="40%">*</td>
<td class="cont" width="60%">skip until first space or end of line</td></tr>
<tr class="cont"><td class="cont" width="40%">b</td>
<td class="cont" width="60%">day of last access</td></tr>
<tr class="cont"><td class="cont" width="40%">v</td>
<td class="cont" width="60%">month of last access</td></tr>
<tr class="cont"><td class="cont" width="40%">e</td>
<td class="cont" width="60%">year of last access</td></tr>
<tr class="cont"><td class="cont" width="40%">x</td>
<td class="cont" width="60%">hours of last access</td></tr>
<tr class="cont"><td class="cont" width="40%">l</td>
<td class="cont" width="60%">minutes of last access</td></tr>
<tr class="cont"><td class="cont" width="40%">k</td>
<td class="cont" width="60%">seconds of last access</td></tr>
<tr class="cont"><td class="cont" width="40%">j</td>
<td class="cont" width="60%">day of creation</td></tr>
<tr class="cont"><td class="cont" width="40%">g</td>
<td class="cont" width="60%">month of creation</td></tr>
<tr class="cont"><td class="cont" width="40%">f</td>
<td class="cont" width="60%">year of creation</td></tr>
<tr class="cont"><td class="cont" width="40%">o</td>
<td class="cont" width="60%">hours of creation</td></tr>
<tr class="cont"><td class="cont" width="40%">i</td>
<td class="cont" width="60%">minutes of creation</td></tr>
<tr class="cont"><td class="cont" width="40%">u</td>
<td class="cont" width="60%">seconds of creation</td></tr>
<tr class="cont"><td class="cont" width="40%">r</td>
<td class="cont" width="60%">CRC (hex)</td></tr>
<tr class="cont"><td class="cont" width="40%">C</td>
<td class="cont" width="60%">поле, описывающее главы (Chapters)</td></tr>
<tr class="cont"><td class="cont" width="40%">(&lt;число&gt;)</td>
<td class="cont" width="60%">optional digits, some or all digits may be missing</td></tr>
</table>
Если строка начинается с символа '<code>^</code>', то поиск подстроки ведётся со второго
символа от начала текущей строки листинга.
</div>

<div class=dfn><dfn>IgnoreString0 ... IgnoreStringN</dfn></div>
<div class=dfndescr>параметры, задающие строки, которые модуль будет игнорировать при анализе листинга.
Если строка начинается с символа '<code>^</code>', то поиск подстроки ведётся со второго
символа от начала текущей строки листинга.
</div>

<div class=dfn><dfn>Extract ... MoveRecurse</dfn></div>
<div class=dfndescr>параметры, описывающие команды архиватора.
<table class="cont">
<tr class="cont"><th class="cont" width="40%">Команда</th><th class="cont" width="60%">Описание</th></tr>
<tr class="cont"><td class="cont" width="40%">Extract</td>
<td class="cont" width="60%">распаковка</td></tr>
<tr class="cont"><td class="cont" width="40%">ExtractWithoutPath</td>
<td class="cont" width="60%">распаковка без путей</td></tr>
<tr class="cont"><td class="cont" width="40%">Test</td>
<td class="cont" width="60%">тестирование</td></tr>
<tr class="cont"><td class="cont" width="40%">Delete</td>
<td class="cont" width="60%">удаление</td></tr>
<tr class="cont"><td class="cont" width="40%">Comment</td>
<td class="cont" width="60%">архивный комментарий</td></tr>
<tr class="cont"><td class="cont" width="40%">CommentFiles</td>
<td class="cont" width="60%">файловый комментарий</td></tr>
<tr class="cont"><td class="cont" width="40%">SFX</td>
<td class="cont" width="60%">преобразование в SFX</td></tr>
<tr class="cont"><td class="cont" width="40%">Lock</td>
<td class="cont" width="60%">запрет модификации</td></tr>
<tr class="cont"><td class="cont" width="40%">Protect</td>
<td class="cont" width="60%">защита от повреждений</td></tr>
<tr class="cont"><td class="cont" width="40%">Recover</td>
<td class="cont" width="60%">восстановление архива</td></tr>
<tr class="cont"><td class="cont" width="40%">Add</td>
<td class="cont" width="60%">добавление файлов</td></tr>
<tr class="cont"><td class="cont" width="40%">Move</td>
<td class="cont" width="60%">перенос файлов в архив</td></tr>
<tr class="cont"><td class="cont" width="40%">AddRecurse</td>
<td class="cont" width="60%">добавление файлов и папок</td></tr>
<tr class="cont"><td class="cont" width="40%">MoveRecurse</td>
<td class="cont" width="60%">перенос файлов и папок</td></tr>
</table>
В командных строках внешних архиваторов для различных операций обработки архивов
могут использоваться псевдопеременные, описанные <a href="arccommands.html">здесь</a>.
</div>

<div class=dfn><dfn>AllFilesMask</dfn></div>
<div class=dfndescr>маска "Все файлы"
</div>


</div>

<h2>Регулярные выражения</h2>
<p>В качестве значений параметров <em>FormatX</em>, <em>IgnoreStringX</em>, <em>Start</em>, <em>End</em>
можно использовать регулярные выражения с синтаксисом Perl5. Для использования
этой возможности необходимо, чтобы соответствующее значение было корректным
регулярным выражением, обрамлённым прямыми слешами ('/') с необязательными
буквенными флагами после заключительного слеша. Допустимы следующие флаги:
<table class="cont">
<tr class="cont"><th class="cont" width="40%">Флаг</th><th class="cont" width="60%">Описание</th></tr>
<tr class="cont"><td class="cont" width="40%"><code>i</code></td><td class="cont" width="60%">игнорировать регистр символов</td></tr>
<tr class="cont"><td class="cont" width="40%"><code>x</code></td><td class="cont" width="60%">использовать расширенный синтаксис (игнорировать пробелы в регулярном выражении)</td></tr>
</table>

<p>Для разбора регулярных выражений используется open-source библиотека
<a href="ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/" target"=_blank">PCRE</a>
(by Philip Hazel, copyright by the University of Cambridge, England).

<p>При использовании регулярных выражений в параметрах <em>FormatX</em> для получения
информации из листинга используются именованные подстроки (вида <code>(?P&lt;name&gt;\w+)</code>).
Распознаются следующие названия полей:
<table class="cont">
<tr class="cont"><th class="cont" width="40%">Поле</th><th class="cont" width="60%">Описание</th></tr>
<tr class="cont"><td class="cont" width="40%">name</td><td class="cont" width="60%">имя файла с относительным путём (пробельные символы в начале и конце строки игнорируются)</td></tr>
<tr class="cont"><td class="cont" width="40%">description</td><td class="cont" width="60%">описание файла</td></tr>
<tr class="cont"><td class="cont" width="40%">size</td><td class="cont" width="60%">размер распакованного файла в байтах (нецифровые символы в этом и других числовых полях игнорируются)</td></tr>
<tr class="cont"><td class="cont" width="40%">packedSize</td><td class="cont" width="60%">размер запакованного файла в байтах</td></tr>
<tr class="cont"><td class="cont" width="40%">attr</td><td class="cont" width="60%">атрибуты файла (A - архивный, R - только для чтения, S - системный, C - сжатый, H - спрятанный, D - директория)</td></tr>
<tr class="cont"><td class="cont" width="40%">cYear, cDay, cMonth, cHour, cMin, cSec</td><td class="cont" width="60%">время создания файла</td></tr>
<tr class="cont"><td class="cont" width="40%">mYear, mDay, mMonth, mHour, mMin, mSec</td><td class="cont" width="60%">время последнего изменения файла</td></tr>
<tr class="cont"><td class="cont" width="40%">mAMPM, mMonthA</td><td class="cont" width="60%">расширенные поля для времени изменения файла</td></tr>
<tr class="cont"><td class="cont" width="40%">aYear, aDay, aMonth, aHour, aMin, aSec</td><td class="cont" width="60%">время доступа к файлу</td></tr>
<tr class="cont"><td class="cont" width="40%">CRC</td><td class="cont" width="60%">32-битная контрольная сумма файла CRC</td></tr>
</table>

<p>Например, для разбора листинга:
<pre class=code>
 Volume in drive D is work
 Volume Serial Number is xxxx-xxxx

 Directory of D:\works\MultiArc\final\Formats

15.11.2004  07:15    &lt;DIR&gt;          .
15.11.2004  07:15    &lt;DIR&gt;          ..
14.11.2004  00:46             5 632 Ace.fmt
14.11.2004  00:46             4 608 Arc.fmt
14.11.2004  00:46             6 656 Arj.fmt
14.11.2004  00:46             6 144 Cab.fmt
15.11.2004  06:07            56 832 Custom.fmt
15.11.2004  07:14             1 551 custom.ini-re
15.11.2004  07:11            54 344 Formats.jkr
14.11.2004  00:46             4 608 Ha.fmt
14.11.2004  00:46             6 144 Lzh.fmt
15.11.2004  07:15                 0 out
14.11.2004  00:46             6 144 Rar.fmt
14.11.2004  00:46             9 216 TarGz.fmt
14.11.2004  00:46             6 656 Zip.fmt
              13 File(s)        168 535 bytes
               2 Dir(s)  37 840 883 712 bytes free
</pre>
<p>применяются следующие установки:

<pre class=code>
Start="/^ Directory of/"
End="/File\(s\)/"
Format0="/^(?P&lt;cDay&gt;\d+).(?P&lt;cMonth&gt;\d+).(?P&lt;cYear&gt;\d+)\s+ (?P&lt;cHour&gt;\d+):(?P&lt;cMin&gt;\d+)\s+(?P&lt;packedSize&gt;[\d\xff]+)\s(?P&lt;name&gt;.*?)\s*$/"
</pre>

<p>Строки:
<pre class=code>
Start="/^..reading directory/"
End="/^..listing completed/"
Format0="/^[^\|]*\|(?P&lt;size&gt;[^\|]+)\|(?P&lt;attr&gt;[^\|]+)\|\s+(?P&lt;name&gt;.*?)\s*$/"
IgnoreString0="/^---- ---- ---- ----/"
</pre>

<p>могут использоваться для разбора листинга:

<pre class=code>
jkRes utility version 002
  pack/unpack tool to work with jkRes resource bundles

..listing files from resource bundle
..reading directory...12 items found
---- ---- ---- ----
    zlib |     5632 | A.... | Ace.fmt
    zlib |     4608 | A.... | Arc.fmt
    zlib |     6656 | A.... | Arj.fmt
    zlib |     6144 | A.... | Cab.fmt
    zlib |    56832 | A.... | Custom.fmt
    zlib |     4608 | A.... | Ha.fmt
    zlib |     6144 | A.... | Lzh.fmt
    zlib |     6144 | A.... | Rar.fmt
    zlib |     9216 | A.... | TarGz.fmt
    zlib |     6656 | A.... | Zip.fmt
    zlib |    13012 | A.... | Custom.ini
    zlib |     1072 | A.... | custom.ini-re
---- ---- ---- ----
..listing completed
..done
</pre>



<br>

<div class=see>Смотрите также:</div><div class=seecont>
<a href="index.html">поддержка архивов</a>
</div>


</body>
</html>
