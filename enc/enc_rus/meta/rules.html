<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>"Правила хорошего тона"</title>
<meta http-equiv="Content-Type" Content="text/html; charset=Windows-1251">
<link rel="stylesheet" type="text/css" href="../styles/styles.css">
<script language="javascript" src='links.js' type="text/javascript"></script>
</head>
<body>

<h1>Спецификация плагинов...</h1>
<div class=navbar>
<a href="index.html">главная</a>
</div>

<h4>...или "Правила хорошего тона". Рекомендации. Версия от 30.04.2001</h4>

<p class=just>Этот документ является попыткой создания спецификации (а вернее
рекомендаций) на плагины к FAR Manager. Пока весь материал будет идти
сплошным текстом (впоследствии разгребем по разделам).</p>

<p class=just>Данный документ - для программистов, пишущих плагины
для FAR Manager.</p>

<p class=just>Добавляйте, уточняйте, рекомендуйте и...</p>

<ol>
<li>Дистрибутив плагина рекомендуется упаковывать в архив ZIP (однозначно,
  т.к. некоторые сервера RAR-архивы "отдают" как text/plain, что в результате
  приводит к т.н. "битому" архиву).<p>&nbsp;<p></li>

<li>Обязательно сопровождать дистрибутив файлом <code>file_id.diz</code>, в
  котором описывать название плагина, версию, дату выпуска,
  краткое описание для чего предназначен плагин (языки русский, английский)
  и координаты разработчика. Файл file_id.diz должен быть обязательно <u>в
  коpне аpхива</u>.<p>&nbsp;<p></li>

<li>Также имеет смысл сопровождать дистрибутив файлом <code>whatsnew.txt</code> (или
  <code>history.txt</code>), в котором описывать, что было изменено (с указанием версии
  и даты).<p>&nbsp;<p></li>

<li>Одинаковые названия для плагинов в диалогах их вызова и настройки:
  <blockquote>
    Если плагин добавляет в меню строку "поиск и замена", то и в меню
    "Параметры внешних модулей" должна быть добавлена строка, начинающаяся
    с "поиск и замена", но уж никак не "а вот это настройки для поиска и
    замены" или просто "настройки", тогда пользователю не придется ломать
    голову над тем, как называются настройки для вашего супер-пупер
    плагина.
  </blockquote>
  <p>&nbsp;<p></li>

<li>Если вы добавляете в дистрибутив плагина какие-либо макросы в виде
    reg-файлов, то не забывайте заполнять переменную <code>"Description"</code>.
  <p>&nbsp;<p></li>

<li><a name="RulesMultiMenu"></a>Стоит исключить добавление нескольких строк
  в меню одним плагином. Лучше плагину показывать свое меню со всеми
  требуемыми функциями:
  <blockquote>
    Не надо добавлять в меню строки "поиск", "замена", "поиск в
    выделенном", не думайте, что ваш плагин - единственный, в этом меню
    разных строк уже и без вас хватает, в подобном случае лучше добавьте
    одну строчку "поиск и замена", а при старте плагина показывайте меню
    со строками "поиск", "замена" и т.д.
  </blockquote>
  <p>&nbsp;<p></li>

<li>Плагин ДОЛЖЕH чистить все временные файлы/каталоги по окончании своей
  работы.<p>&nbsp;<p></li>

<li>Если плагин предусматривает обработку определенной группы файлов (по маске),
  то должна быть возможность задать эту маску, а не обрабатывать
  все файлы подряд.<p>
  Пример.
  <blockquote>
    Trucer удаляет конечные пробелы из редактируемого файла. Он позволяет
    задать маску исключений. Это хорошо. Если бы он обрабатывал все подряд,
    было б плохо. Вывод: если мы хотим обрабатывать не все файлы, то это
    должно быть предусмотрено путем маски исключений или включений и,
    желательно, настраиваемо пользователем.
  </blockquote>
  <p>&nbsp;<p></li>

<li>Если плагин позволяет совершить несколько различных действий с такими
  файлами, то следует предусмотреть возможность доступа к каждому действию
  из командной строки/меню пользователя/ассоциаций.<p>
  Пример.
  <blockquote>
    Плагин "shell link..." (про версию 1.20!) позволяет  юзеру  редактировать
    свойства ярлыка и переходить по нему к конкретному файлу.  Это  делается
    из меню плагинов. Это не есть хорошо. Лучше было б, если  Оскар  (автор)
    добавил работу с префиксом для командной строки. Тогда, например,  можно
    было бы сделал ассоциацию на *.lnk по  f4  -  редактирование  свойств,
    enter  - переход по ссылке. Это интуитивно понятнее.
  </blockquote>
  <p>&nbsp;<p></li>

<li>Все сообщения, выдаваемые плагином на экран (в диалогах или в меню), должны
  содержаться в <a href="language/language_files.html">LNG-файлах</a>. Как
  альтернативный вариант - использовать модуль локализации
  <a href="addons/locmsg.html">LocMsg.cpp</a> из
  бонуса к Энциклопедии (рекомендуется использовать LocMsg.cpp в плагинах
  второго уровня или для тех случаев, когда необходимо, чтобы ваш плагин
  реагировал на изменения в файле сообщений без перезапуска FAR).
  Это позволит сделать плагин языконезависимым.
  <p>&nbsp;<p></li>

<li>При длительных операциях дать возможность пользователю прервать процесс.
  То есть, примерно то, о чем говорится в статье <a href="articles/escape.html">"Обработка
  нажатия ESC или "Авторам долгодумающих плагинов посвящается..."</a>. Это однозначно
  должно быть. Даже в таких плагинах как colorer. Hельзя, чтоб FAR умирал
  из-за того что colorer не может провести парсинг строки в 200 кил.
  <p>&nbsp;<p></li>

<li>В файлах помощи рекомендуется:<ul>
   <li>размещать всю необходимую для работы информацию:
     "зачем хранить на винте всякие ридми? Они у меня есть, но лежат в
      архиве. Какой смысл мне лезть в архив за доп.информацией? Imho,
      можно и hlf помещать все, что нужно для работы, просто следует
      отделять обычные сведения от advanced и ставить ссылочки типа
      "подробнее", "расширенное", "advanced"... Тогда не придется в самый
      неподходящий момент закрывать плагин и искать этот отдельный
      текстовый файл. Все это "IMHO", естественно."

  <li>на главной странице
    <ol>
     <li>указывать назначение плагина и версию
     <li>ссылки на прочие разделы
    </ol>

  <li>желательно иметь раздел "Alphabetical list", где перечислены все
    существующие разделы.

  <li>в любом разделе помощи предусмотреть линки на главную страницу.

  <li>обязательно нужно проверить то, как будет выглядеть любая из страниц
     помощи при размере консоли 80x25. Многие об этом забывают, в
     результате, помощь показывается нормально только у авторов, а у других
     строчки "съезжают". Помочь в проверке может плагин HlfViewer.
  </ul>
  <p>&nbsp;<p></li>

<li>Вызов плагина на текущем файле через F11 в любом случае нужно сделать из
  соображений хорошего тона, равно как и дать возможность пользователю
  отключить в настройках плагина функциональность
  <a href="exported_functions/openfileplugin.html">OpenFilePlugin</a>.
  <p>&nbsp;<p></li>

<li>И про вызов из командной строки через префикс не забыть бы :-). Хорошо
  бы, чтобы этот префикс был настраиваемым в конфигурации плагина,
  во избежание пересечения с чем-нибудь ещё.<p>&nbsp;<p></li>

<li>Плагин в своем меню может и не иметь средств изменения порядка
  элементов меню, но уж если имеет, то это должно делаться по
  Ctrl-Up/Down.<p>&nbsp;<p></li>

<li>Старайтесь всегда при показе меню использовать флаг
   <a href="service_functions/menu.html#FMENU_WRAPMODE">FMENU_WRAPMODE</a>,
  его отсутствие причиняет лишние неудобства пользователям.<p>&nbsp;<p></li>

<li>Про меню.<ol>
   <li>Если его текст заканчивается многоточием ("...") - получу диалоговое окно
   <li>Если в тексте, выровненный по правому краю, имеется значок "&gt;" -
       получу подменю
   <li>В противном случае, будет сразу выполнена выбранная мной команда.
   </ol>
   Пример:
  <blockquote>
        Только что понадобилось отпечатать текст, первый раз решил сделать
        это из FAR. Через Print Manager. Ставлю курсор на файл, F11 /
        Print Manager. В полученном меню вижу "Print selected files" и
        не знаю, что будет, если я этот пункт выберу - сразу печать или
        что-то еще из настроек. Аналогично дальше то же самое в списке
        принтеров. В итоге жутко неудобно.
  </blockquote>
  <p>&nbsp;<p></li>

<li>Если Ваш плагин использует компоненты (DLL, OCX, etc), не входящие в
   состав Windows, не поленитесь указать это в разделе "Инсталляция" своего
   readme.txt.
   <p>Идеально, если вы протестируете установку своего плагина на "голую"
   (только что установленную в минимальной конфигурации) Windows 95.
  <p>&nbsp;<p></li>

<li>Обрабатывая клавиатурные события редактора, не забывайте о том, что
    к клавишам перемещения курсора относятся не только общеупотребительные
    (Left, Right, Up, Down, PgUp, PgDn, Home, End), но и такие сочетания как
    <code>Ctrl-N</code>, <code>Ctrl-E</code> и <code>Ctrl-S</code>.
  <p>&nbsp;<p></li>

<li>Если вы прилагаете к своему плагину для редактора комплект
макросов для обеспечения быстрой и удобной работы, а ваш плагин
не является универсальным и указанные макросы имеют смысл,
например, только при редактировании исходных текстов программ на
С++ или только для текстовых файлов, то не следует использовать
обычные макросы, хранящиеся в реестре, т.к. они будут действовать
на все редакторы и только занимать лишние клавиши в файлах
другого типа. Вместо этого можно предлагать пользователю комплект
макросов для плагина [ESC] (тут в скобках должно быть имя автора,
прямая ссылка на плагин или просто на домашнюю страницу автора,
т.к. плагин может меняться и урл будет меняться тоже) или
аналогичного другого плагина (на момент написания этих строк
таковой не известен), которые практически ничем не отличаются от
макросов FAR, но лишены перечисленных недостатков (действуют
только на указанные пользователем типы файлов и не занимают место
в реестре).


</ol>
</body>
</html>