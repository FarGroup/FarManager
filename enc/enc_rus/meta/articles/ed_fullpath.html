<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>

<title>Как получить полный путь редактируемого файла...</title>
<meta http-equiv="Content-Type" Content="text/html; charset=Windows-1251">
<link rel="stylesheet" type="text/css" href="../../styles/styles.css">
<link REV="made" href="mailto:vskirdin@mail.ru">
<meta name="Author" content="Valentin Skirdin">
<meta name="description" content="Как получить полный путь редактируемого файла из плагина в редакторе? How to get a full path of edited file from the plugin in the editor?">
<script language="JavaScript" src='../links.js' type="text/javascript"></script>
</head>
<body>

<a name="top"></a>
<h1>Как получить полный путь редактируемого файла из плагина в редакторе?</h1>
<div class=navbar>
<a href="../index.html">главная</a> |
<a href="index.html">статьи</a>
</div>

<div align=right><code>
Валентин Скирдин <a href="mailto:Valentin%20Skirdin%20<vskirdin@mail.ru>?subject=Articles">
<img src="../../images/email.gif" border="0" alt="[vskirdin@mail.ru]" width="16" height="16" align="middle">vskirdin@mail.ru
</a>
</code></div>
<hr color="#003399">

<p class=note><img src="../../images/note.gif" alt="Замечание" width="10" height="10"> Замечание</p>
<UL class=note><LI>Материал данной статьи потерял всякую актуальность с выходом FAR Manager 1.65, но оставлен в качестве учебного пособия.
</LI></UL>

<p class=plain>В FIDO этот вопрос задавали, здесь повторяют... </p>

<p class=plain>Решил я поэкспериментировать с этим
вопросом, и вот что у меня получилось. Очень
кратко, самую суть...</p>

<p class=plain>После получения информации о
редактируемом файле в <code>EditorInfo-&gt;Filename</code>
находится имя редактируемого файла. Если имя
файла без пути, то файл явно в текущем каталоге.
Воспользуемся экспортируемой функцией <code><a href="../exported_functions/processeditorevent.html">ProcessEditorEvent</a></code>
(событие <code><a href="../exported_functions/processeditorevent.html#EE_READ">EE_READ</code></a>)&nbsp; и тем фактом, что в полный
путь входит имя диска.</p>

<pre class=code>char Buffer[250]={0};
char *FilePart;

int WINAPI _export <b>ProcessEditorEvent</b>( int Event, void *Param)
{
  <b>if(Event == EE_READ)</b>
  {
    struct EditorInfo ei;
    Info.EditorControl(ECTL_GETINFO,&amp;ei);
    <b>if(!strrchr(ei.FileName,':'))</b>
    {
      DWORD retlen;
      retlen=<a href="win32/getfullpathname.html">GetFullPathName</a>(ei.FileName,240,Buffer,&amp;FilePart);
    }
    else
      lstrcpy(Buffer,ei.FileName);
  }
  return 0;
}</pre>

<p class=plain>Событие EE_READ происходит один
раз, после того, как редактор загрузил файл на
редактирование. На этом и построен весь механизм
определения полного пути к файлу. После
отработки этого фрагмента у Вас всегда в
переменной <em>Buffer</em> будет имя редактируемого файла с
полным путем.</p>


<div align=right><code>
<br>&nbsp;<br>
19.08.1999
</code></div>
<div class=seecont><a href="#top">наверх</a></div>

</body>
</html>