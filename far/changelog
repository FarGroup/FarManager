t-rex 17.04.2008 20:16:28 +0200 - build 2357

1. Убрал "TEST ONLY", это давно уже у нас нифига не значит и слово alpha/beta и так вполне достаточно.

drkns 15.04.2008 07:23:53 +0200 - build 2356

1. Продолжение эпопеи о дополнительной клавиатуре и включенном по умолчанию TechInfo#48,
   теперь на тему AltShiftIns/AltShiftNum0 в панелях.

drkns 14.04.2008 20:26:46 +0200 - build 2355

1. При удалении общего макроса неправильно формировалось имя ключа в реестре,
   вследствие чего удаление макроса работало только в пределах текущей сессии.

2. При назначении макроса на клавишу, которой уже был сопоставлен общий макрос,
   запрашивалось подтверждение удаления общего макроса.

3. Продолжение 2326: еще немного соответствия основных и дополнительных курсорных
   клавиш в диалоге результатов поиска, на этот раз home/end/pgup/pgdn.

drkns 09.04.2008 21:27:35 +0200 - build 2354

1. Mantis#0000506: Когда в данном режиме перемещаешься во второй понели по каталогам - Far часто перерисовывает панели

2. С форума: "Переход к найденному по Alt+F7 файлу не меняет заголовок"

3. Mantis#0000280: Move/Rename папки с заблокированным файлом.
   Самое смешное - в 1.70 beta 4 это так и работало.

svs 03.04.2008 01:10:35 +0300 - build 2353

1. Macro: добавлены функции работы с закладками
     N=BM.Del([Idx]) 
       удаляет закладку с указанным индексом (1...), 
       Idx=0 или параметр Idx не указан - удаляет текущую закладку
     N=BM.Get(Idx,M)
       возвращает параметры закладки с индексом (Idx=1...), Idx=0 - текущая закладка
       M=0 - координаты строки (начиная с 1)
       M=1 - координаты колонки (начиная с 1)
       M=2 - позиция, соответствующая первому видимому символу текста на экране слева
       M=3 - номер строки, соответствующей первой видимой строке текста на экране
     N=BM.Stat([M]) 
       возвращает информацию о закладках
       M=0 - текущее количество закладок
       На сейчас параметр роли не играет, можно указывать любое число или не указывать
       параметр совсем. Функция не обозвана как BM.Count так, как предполагается,
       что, если стековые букмарки распространить на вьювер или панели или... то может
       понадобится еще какая нибудь информация.

2. Кое-где, в классах верхнего уровня не передавались параметры vParam и iParam 
   в функции VMProcess низлежащих классов.

ts 01.04.2008 23:57:46 +0200 - build 2352

1. Проверка на запись в ECTL_GETSTACKBOOKMARKS

2. Подготовка функций для макросов

svs 31.03.2008 13:01:23 +0300 - build 2351

1. Mantis#0000516: Пропадание курсора в редакторе
   проблема возникает тогда, когда файл большой и срабатывает таймаут...

2. ULARGE_INTEGER & Borland.
   Можно попросить при юзании ULARGE_INTEGER часть "u." указывать?
   Спасибо.

ts 30.03.2008 18:08:57 +0200 - build 2350

1. Добавлена коррекция позиций в стековых закладках при удалении и вставке строк.
   При удалении строки в позиции закладки происходит удаление этой закладки.

2. В апи редактора добавлены новые команды управления позициями навигации:
   ECTL_DELETESTACKBOOKMARK (при Param равном -1 удаляет текущую позицию
   навигации, при 0 и более - позицию с указанным индексом) и
   ECTL_GETSTACKBOOKMARKS (Param указывает на заполняемую структуру
   EditorBookMarks или равен NULL, возвращает общее количество позиций).
   Описание всех комманд в Энц.

3. Изменена навигация в начальной и конечной позициях.

4. Исправлен алгоритм добавления позиции навигации. Теперь нельзя добавить две и
   более позиций навигации подряд на ту же позицию.

t-rex 29.03.2008 14:45:25 +0200 - build 2349

1. Начал делать Mantis#260: "динамический фильтр по дате".
   Всё готово в общем кроме интерфэйса - интерфэйс пока временный для тестирования фичи (идеи приниматся).
   Относительная дата вносится в днях, часах, минутах и секундах (дней хоть 9999).
   От месяцев и годов отказался ибо это не точные числа.

t-rex 29.03.2008 09:15:50 +0200 - build 2348

1. Panel API: Флаги PFLAGS_PANELLEFT и PFLAGS_PANELRIGHT.

svs 27.03.2008 16:54:21 +0300 - build 2347

1. Macro: добавлена макрообласть "Consts" для хранения именованных констант.
   Константы располагать в ветке реестра "KeyMacros\Consts". Синтаксис аналогичен "Vars", т.е.
   Код:
   KeyMacros\Consts
     "StringName":REG_SZ
     "IntName":REG_DWORD
   Имена констант произвольные, начинающиеся с буквы...
   Константы аля "ShiftIns" не имеют право на жизнь (хотя "ShiftIns1" допустим для имени)

   Вот вполне работоспособный макрос с использование константы FIB_PASSWORD.

   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Consts]
   "FIB_PASSWORD"=dword:00000002
   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Editor\CtrlP]
   "Sequence"="%s=prompt(\"Password\",\"Input password:\",FIB_PASSWORD); $Text %s"
   "DisableOutput"=dword:00000001

   Константы ФАР считывает из реестра при старте и хранит в таблице glbConstTable
   Т.к. это константа, то ее наличие можно только проверить функцией checkMacroConst()

2. Переделаем функцию varLook. Было так, что она всегда добавляла переменную, даже если
   параметр ins = 0. В ней тек же удален параметр error. Вместо этого функция возвращает
   ссылку или NULL. В связи с этим переделки в макроисполняторе.

drkns 26.03.2008 10:19:23 +0200 - build 2346

1. Mantis#0000510: Тип FarDialogEvent.Result должен быть PLONG_PTR, а не LONG_PTR
   Result оставлен LONG_PTR, но теперь содержит само значение, а не указатель на него.
   Вроде бы ещё никто не успел использовать это в плагинах :)

t-rex 25.03.2008 23:45:16 +0200 - build 2345

1. Немного стормозил в 2344, доделал.

t-rex 25.03.2008 23:00:09 +0200 - build 2344

1. Оптимизация Editor::GoToLine ибо уж полный ужас был.

t-rex 25.03.2008 22:08:17 +0200 - build 2343

1. Mantis#499: Invalid file handle used in ShellCopy::ShellCopyFile().

svs 25.03.2008 21:47:01 +0300 - build 2342

1. Macro: добавлен Editor.RealPos - текущая поз. в редакторе без привязки к размеру табуляции

2. Macro: функция S=prompt("Title"[,"Prompt"[,flags[, "Src"[, "History"]]]])
   Mantis#0000512: N = prompt(Title, Text, Flags)
   Описание в Энц.

svs 25.03.2008 18:00:08 +0300 - build 2341

1. Уточнения в panel.SetPath и опциональных параметров

svs 25.03.2008 16:50:12 +0300 - build 2340

1. У XXX::SetCurDir - параметр const + функция возвращает BOOL - удачно или неудачно сделан переход

2. Macro: Добавилась функция -  N=panel.SetPath(panelType,pathName[,fileName])
   установить на панели каталог pathName, опционально можно указать имя файлового объекта (для курсора, как в panel.SetPos)

3. Некоторые макро-функции могут иметь опциональные параметры
     S=itoa(N[,radix]) - здесь, если radix не указан, подразумевается 10
     N=Menu.Select(S[,N]) - здесь N подразумевается = 0
     N=panel.SetPath(panelType,pathName[,fileName]) - здесб пустая строка
     S=replace(Str,Find,Replace[,Cnt]) - Cnt=0 => до бесконечности
     S=substr(S,N1[,N2]) - до конца строки
     + msgbox - последний параметр (флаги) могут быть опущены, подразумевается 0

   Для этого в структуре __TMacroFunction добавлен параметр oParam.
   В интерфейсе параметры можно опускать, в коде они добиваются PushInt(0)

4. Macro: Добавлена операция BitNot '~'
   (вроде ничего не отвалилось :-)

drkns 25.03.2008 07:15:18 +0200 - build 2339

1. Mantis#0000004: DI_EDIT в Message для полей с именами файлов.
   Message теперь "умный": если строка длиннее, чем влезает - она кладётся в DI_EDIT, иначе - как раньше.
   Соотвественно, при вызовах Message убраны TruncPathStr.

2. Mantis#0000080: Перемещение символической связи на другой диск.

zg 25.03.2008 02:06:34 +0200 - build 2338

1. при TabSize=1 ShiftTab вначале строки приводил к отрицательной текущей колонке.

t-rex 22.03.2008 21:05:11 +0200 - build 2337

1. Нашел то место из за которого раньше да было нормально делать -1. Оно там закоменчено но на всякий пожарный добавил -1 туда.

2. Ещё заметил пару глюков рядом, главный из них что DM_LISTINSERT возвращал не то что в енц. описано.

t-rex 22.03.2008 20:27:29 +0200 - build 2336

1. DM_LISTADDSTR возвращал почему то index-1 добавленной строки. Из за этого страдал как минимум NewArc.

svs 20.03.2008 18:12:26 +0300 - build 2335

1. Добавлен Disable цвет для пред. билда и изменены наименования пунктов меню в настройке цвета
   Итого размер палитры ФАРа = 0x7F байт

2. В History/Combobox стрелки отображались цветом меню - жлбавим флаг VMENU_COMBOBOX

svs 17.03.2008 13:52:15 +0300 - build 2334

1. Mantis#0000498 - Screen scrolling arrows colors for Menu/Listbox/Combobox
   Добавлены цвета, связанные со стрелками:
     COL_DIALOGLISTARROWS,
     COL_DIALOGLISTARROWSSELECTED,
     COL_DIALOGCOMBOARROWS,
     COL_DIALOGCOMBOARROWSSELECTED,
     COL_WARNDIALOGLISTARROWS,
     COL_WARNDIALOGLISTARROWSSELECTED,
     COL_WARNDIALOGCOMBOARROWS,
     COL_WARNDIALOGCOMBOARROWSSELECTED,
     COL_MENUARROWS,
     COL_MENUARROWSSELECTED,

2. Добьем '>' - выкинут лишний кусок по расчету новой длины строки.
   Немного оптимизации...

drkns 17.03.2008 07:36:28 +0200 - build 2333

1. Уточнение в отрисовке '>' при прокрутке строк VMenu.

t-rex 15.03.2008 17:40:12 +0200 - build 2332

1. Mantis#87: Копирование и жёсткие связи.

svs 15.03.2008 17:50:07 +0300 - build  2331

1. Ctrl-N в списках убираем (http://forum.farmanager.com/viewtopic.php?f=3&t=3130)

drkns 15.03.2008 15:53:04 +0200 - build 2330

1. Mantis#0000222: Не вполне корректная работа (или не работа) с потоками, привязанным к директориям.
   Тут потоки в общем не при чём, дело в обработке путей "\\?\c:\" и "\\?\Volume{GUID}\".
   Заодно поправил еще пару мест c этими путями.

t-rex 15.03.2008 13:00:13 +0200 - build 2329

1. Mantis#467: Не пускает на плагинную панель; неправильные элемены панели.
   Исправил, но нифига не понимаю :)

t-rex 14.03.2008 18:51:39 +0200 - build 2328

1. Mantis#458: Из истории папок запускается плагин с 1-буквенным префиксом.

t-rex 14.03.2008 00:50:55 +0200 - build 2327

1. Mantis#463: Текущая папка процесса не меняется из юзер меню и отличается от активной панели.
   Во первых юзер меню сам переходил по папкам хотя это там нафиг не надо было,
   а во вторых был совершенно не нужный AI с восстановлением пути.
   Просто всё удалил (и ещё мусор который под руку попался).

drkns 13.03.2008 18:50:08 +0200 - build 2326

1. Mantis#0000462: !=\ изменила поведение

2. Mantis#0000469: Ошибочное сообщение "Длина имени файла превышает системные ограничения"

3. В UserMenu, MainMenu и поиске по-разному вели себя курсорные клавиши на основной и доп. клавиатуре.

svs 12.03.2008 14:15:11 +0300 - build 2325

1. В диалоге фильтров нажать Reset - в комбобоксах размера и даты видим символ '&'
   Введем Edit::SetHiString(), аналог HiText2Str.

svs 12.03.2008 10:38:08 +0300 - build 2324

1. После 2323 "сломалась" навигация по раскраске в диалоге FileFilterConfig

2. Если в при вызове диалога фильтра/раскраски/сортировки второй параметр ColorConfig равен true
   то меняем заголовок диалога и подставляем нужный топик хелпа, относящийся не к фильтрам, а к раскраске.

3. Изменены хоткеи.

4. В VMenu, если установлен VMENU_TRUNCMODE, то ShowPos у элементов сбросим в ноль.

svs 11.03.2008 19:09:48 +0300 - build 2323

1. Macro: клавиша вызова наследуется из основного макроса при вызове eval()
   для этого у функции KeyMacro::PostNewMacro() добавлен новый параметр - клавиша вызова.
   например ('y' - клавиша назначения),
     y=eval("< $AKey >")
   теперь печатает "<y>" (было '<>')

2. Macro: V=akey(N) - функция возвращает имя или код клавиши, инициировавшей макрос.

3. Macro: Bug: если в макропоследовательности есть только 1 "клавиша", отличная от набираемых на клавиатуре
   (например, $AKey), то такой макрос ничего не делает (точнее может делать все, что угодно).
   Это остатки (недопеределки) предыдущих изысканий из области сокращения объемов памяти
   (было - если клавиша одна, то память не выделяется, а Buffer считается не как указатель на массив DWORD`ов,
   а как значение DWORD).

4. Dialog: bug: когда в комбобоксах применяются хоткеи, в строку редактирования символ '&' тоже попадает.

5. В историях - строка в список попадает полностью (не ограничена 128 байтами)
   (в зависимости от размера - используется либо Text либо TextPtr)

6. Фильтры: в конце filefilterparams.cpp::MenuString() сделаем обрезание концевых пробелов.

7. API: BUGs!
   а) MIF_USETEXTPTR по значению равен LIF_DELETEUSERDATA.
      С точки зрения юзера пофигу, но внутри каша, т.к. меню и список - суть одного => VMenu.
   б) если используется MIF_USETEXTPTR (вернее, если у итема пункта меню используется NamePtr), то...
      это значение так и "подвисат" - нигде память не освобождается.

8. API: добавлен флаг LIF_USETEXTPTR. Лист использует динамическую компоненту итема.
   Для публикации необходимо:
   а) уточнение FarListItem
   б) изменения в работе Dialog API.

9. API: добавлены флаги: FMENU_TRUNCPATH, FMENU_TRUNCSTR, FMENU_TRUNCSTREND.
   Показывают как нужно обрезать выводимый на экран пункт меню. Оригинальный текст пункта не изменяется.

10. В установщике файловых атрибутов и фильтрах добавлена обработка атрибута FILE_ATTRIBUTE_VIRTUAL.

11. В любом объекте, основанном на VMenu действуют клавиши
     Ctr-N - включить/выключить режим обрезания выводимых итемов списка
     Alt-Home/Alt-End - прокрутка всех элементов списка по горизонтали в начало/конец
     Alt-Left/Alt-Right - прокрутка всех элементов списка по горизонтали влево/вправо на 1 символ
     Alt-Shift-Left/Alt-Shift-Right - прокрутка текущего элемента списка по горизонтали влево/вправо на 1 символ

    TODO: ОТКРЫТЫЙ ВОПРОС ПРО Ctrl-N !!!

12. Mantis#0000264: Недочёты диалога редактирования группы раскраски
    1. изменен tab-ордер задаваемых цветов
    2. добавлены горячие клавиши в комбобоксах Size и Data/Time.

t-rex 11.03.2008 11:33:32 +0200 - build 2322

1. Mantis#468: Закрытие быстрого просмотра папок вызывает VE_CLOSE (без VE_READ)
   Тут типа 2 бага:
   1. То что qview вообще создаёт объект въювера при просмотре папки.
   2. То что в деструкторе посылается VE_CLOSE хотя никакого файла открыто небыло.

drkns 09.03.2008 12:28:26 +0200 - build 2321

1. Обнаружены чудеса: strncat(dst,src,sizeof(dst)-1)
   На всякий случай: 3-й параметр в strncat - это "сколько дописываем", а не "сколько влезает".
   Во всех подобных местах strncat заменена на xstrncat, где 3-й параметр уже таки размер приёмника-1.

2. Комбобокс, открытый по Alt-Hotkey, при закрытии получал DN_EDITCHANGE
   с параметрами предыдущего фокусного элемента.

3. В открытый комбобокс не приходили события от мыши.

4. Мелкий баг в диалоге задания макрокоманды.

t-rex 09.03.2008 12:14:58 +0200

1. Конфликты хоткеев диалоге фильтров (анг).

zg 20.02.2008 18:45:55 +0200 - build 2320

1. hotplug devices list. при удалении подряд нескольких устройств - визуальные глюки.
2. варнинги в gcc.

drkns 12.02.2008 22:41:46 +0200 - build 2319

1. По мотивам 1.80.415 и 1.80.417:
   - Добавлена поддержка навигации а-ля браузер в редакторе: макрофункции N=BM.Add(),
     N=BM.Clear(), N=BM.Next(), N=BM.Prev(), N=BM.Stat().

     Причем...
      а) нужно доработать математику "BM.Stat()" (что-то типа StatStackBookmark())
      б) "BM.XXX" в принципе может быть не только "редактор" :-)
      d) Хмм... индикацию, опять же... стекового букмарка...

   - В апи редактора добавлены команды управления позициями навигации: ECTL_ADDSTACKBOOKMARK,
     ECTL_PREVSTACKBOOKMARK, ECTL_NEXTSTACKBOOKMARK, ECTL_CLEARSTACKBOOKMARKS для добавления
     позиции навигации, переход к предыдущей, следующей позициям навигации и очистка списка
     навигаций.

2. Уточение в отрисовке открытого комбобокса.

Zuz 25.01.2008 23:02:30 +0500 - build 2318

1. Mantis#000337, Mantis#0000176 refix.
2. Двойное обновление панели после CTRL-Z.

drkns 18.01.2008 23:50:57 +0200 - build 2317

1. Уточнение в plugin.hpp.

Zuz 17.01.2008 09:53:33 +0500 - build 2316

1. Поломал поиск по содержанию файла в Win9x (bulid 2314), починил (буду переделывать позже).

svs 11.01.2008 12:21:53 +0300 - build 2315

1. Mantis#0000456: Функция ConvertNameToReal не работает для симлинков
   Изменения, аналогичные 1.80
   Для повторения:
     1. Создаём иерахию папок C:\1\1.1\1.2\1.3\
     2. Создаём папку C:\2
     3. Для папки C:\1\1.1 создаём симлинк C:\1.1
     4. Для папки C:\1.1\1.2\1.3 создаём симлинк C:\2\1.3
     5. Создаём файл C:\1\1.1\1.2\1.3\Test.txt
     6. Пытаемся скопировать C:\1\1.1\1.2\1.3\Test.txt в C:\1.1\1.2\1.3\ - всё ок.
        Выдаётся ошибка, что нельзя копировать файл сам в себя.
     7. Пытаемся скопировать C:\1\1.1\1.2\1.3\Test.txt в C:\2\1.3\ - всё плохо.
        Появляется диалог копирования, а потом вылазит ошибка совместного доступа к файлу.

2. Mantis#0000425: Add support of FILE_ATTRIBUTE_OFFLINE attribute
   Изменения, аналогичные 1.80

3. Добавка для Borland < 5.5 ==> INVALID_SET_FILE_POINTER

4. Добавлен FILE_ATTRIBUTE_VIRTUAL
    Пока что для отображения. Если "нада" - делать изменения по аналогии c FILE_ATTRIBUTE_OFFLINE...
   ..типа ID_FF_VIRTUAL и еже с ним...
   ...если кто объяснит как ЭТО УВИДЕТЬ!

5. Немного добавок в syslog.cpp

Zuz 12.01.2008 01:59:33 +0500 - build 2314

1. Ещё немного снижены требования к правам (Mantis#0000453).

2. В FindFiles::LookForString замена libc API для файловых операций на WIN32 API.

drkns 06.01.2008 14:57:04 +0200 - build 2313

1. Новые псевдоклавиши MsWheelLeft и MsWheelRight - горизонтальная прокрутка колеса мыши (для Vista и выше).
   В TI#33 добавлены параметры MsHWheelDelta*.

svs 05.01.2008 19:19:37 +0300 - build 2312

1. По аналогии с Mantis#0000414 "починем" хэндлы файлов в поисковике и вьювере

2. Mantis#0000453: При поиске файлов с учетом содержимого файлы открываются с запросом прав на изменение
   (тянет еще аж с 1.65...)

3. Небольшое уточнение в registry.cpp::MkKeyName - RegMon`у не нравится... например, такое: "HKCU\\Console"


drkns 02.01.2008 15:43:25 +0200 - build 2311

1. Мелкое уточнение в TI#78.

drkns 31.12.2007 20:03:57 +0200 - build 2310

1. Некорректная работа GetPathRoot() для относительного пути внутри симлинка.

2. При вызове меню плагинов из диалогов не выставлялась соответствующая макрообласть.

3. В диалог подтверждения перезаписи файла добавлена кнопка "Append all".

4. Mantis#0000023: ConsoleAlias. Работает в комстроке и меню пользователя.
   Поддерживается стандартный спецсимвол $*. Управлять этим делом можно с помощью doskey.

5. TechInfo #78:
   [HKEY_CURRENT_USER\Software\Far\Interface]
   "FormatNumberSeparators":REG_DWORD
   Параметр  "Interface/FormatNumberSeparators"  с  типом  DWORD  позволяет
   определять символы,  используемые в качестве разделителей групп разрядов
   и целой/дробной части чисел.
   Старшее слово - код символа для разделителя групп разрядов.
   Младшее слово - код символа для разделителя целой и дробной части.
   По умолчанию значение - 0 (использовать региональные настройки ОС).

6. Добавлена команда ACTL_REDRAWALL - перерисовка всех фреймов фара.

svs 28.12.2007 14:03:02 +0300 - build 2309

1. Mantis#0000452: Bug, doubling code and improvements in hotplug.cpp
   Кроме указанного бага устранен "оверквотинг" по памяти - strcpy :-(

yjh 15.12.2007 00:39:46 +0300 - build 2308

1. Доделка фильтров "исключения" при поиске (Alt-F7) в отношении каталогов.
   Теперь поведение фильтров такое же как в копировании, т.е. если включена
   фильтрации и в списке есть "запрещающий" (-) фильтр, то когда под его
   действие попадает каталог пропускается не только сам каталог, но и всё
   что находится в нём (и его подкаталогах). Разумеется, это верно только при
   выключенном D+ :)


drkns 14.12.2007 21:59:01 +0200 - build 2307

1. Меню плагинов можно вызывать по F11 из диалогов.
   Чтобы попасть в это меню, плагин должен установить флаг PF_DIALOG в PluginInfo.Flags.
   Вызванный плагин получает следующие параметры в OpenPlugin():
   - OpenFrom: OPEN_DIALOG
   - Item: указатель на структуру OpenDlgPluginData:
     struct OpenDlgPluginData
     {
      int ItemNumber; //номер выбранного пункта в меню из зарегистрированных плагином пунктов
      HANDLE hDlg;    //хэндл диалога, из которого вызван плагин
     };

2. Плагин может экспортировать ProcessDialogEvent для обработки поступающих в диалог событий:
   int ProcessDialogEvent(int Event, void* Param)
   Event:
    DE_DLGPROCINIT - событие поступает в обработчик
    DE_DEFDLGPROCINIT - событие поступает в стандартный обработчик
    DE_DLGPROCEND - событие уже обработано

   Param - указатель на структуру FarDialogEvent:
   struct FarDialogEvent
   {
    HANDLE hDlg;
    int Msg;
    int Param1;
    LONG_PTR Param2;
    LONG_PTR Result;
   };

   return:
   - TRUE - событие обработали сами, не продолжать обработку.
     FarDialogEvent.Result - указатель на переменную, используемую обработчиком
     в качестве возвращаемого значения.
   - FALSE - продолжить обработку события.

svs 14.12.2007 18:02:33 +0300 - build 2306

Уф... как то много набралось... возможно нужно было бы разбить на несколько...

1. Mantis#0000428: Вновь DI_COMBOBOX
   Отсутствовала проверка на тип элемента.

2. Mantis#0000429: Не очищается и не сохраняется кеш директорий

3. Macro: BOF, EOF, EMPTY и SELECTED не обрабатывались в ком.строке

4. Mantis#0000415: произошли какие-то непонятные изменения в DI_COMBOBOX
   (в 2283 сломалось)

5. Macro: Menu.Select теперь с двумя параметрами, второй - как искать строку:
      0 = full compare
      1 = begin compare
      2 = end compare
   (надо бы не забыть сделать MCODE_F_MENU_SELECT и в 1.80, после отработки вопроса)

6. Macro: Заготовки в коде для двух функций:
      MCODE_F_REPLACE        ==>  Result=replace(Str,Find,Replace,Cnt)
                                  Cnt=0 - заменить все, что найдем.
    и
      MCODE_F_CALLPLUGIN     ==>  S=callplugin(S,Path,N)
      позволит вместо 'F11 t' писать 'callplugin("Временная панель\nTemporary panel",блаблабла)'
      т.с. небольшой уход от хоткеев, для большей восприимчивости кода макроса :-)

      Пока не доделан...
      Предложения, идеии, etc. по этой функции... (2yjh: Юра, это в основном тебя касается :-))

7. API: пусть OPEN_FILEPANEL будет официальным, а не спрятанным.

8. Крайне эксперементально :-)
   Переделка PluginsSet::CallPlugin в предвериях п.6.1
   У новой функции PluginsSet::FindPlugin() параметры:
      ModuleName ==> список с разделителями '\n' или '\r', например, "Временная панель\nTemporary panel"
                     т.е. FindPlugin "умеет" искать не только одно значение...
      FindMode   ==> 0=полное совпадение, 1=подстрока с начала, 2=подстрока с конца
      QueryMode  ==> 0=искать среди ModuleName, 1=искать среди Info.PluginMenuStrings[]

   В коде присутствуют оба кода - старый и новый, разделенные посредством "#if 1".
   Потом старый код уберу, когда будет понятно, что ОНО нормально пашет.

9. Добавлена функция VMenu::DeleteSelectedItems() для удаления прочекинных элементов меню.

10. API: Команда MCMD_GETSTATE для ACTL_KEYMACRO,
    возвращает одно из значений (перечисление FARMACROSTATE):
      enum FARMACROSTATE {
        MACROSTATE_NOMACRO          =0,  // не в режиме макро
        MACROSTATE_EXECUTING        =1,  // исполнение: без передачи плагину пимп
        MACROSTATE_EXECUTING_COMMON =2,  // исполнение: с передачей плагину пимп
        MACROSTATE_RECORDING        =3,  // запись: без передачи плагину пимп
        MACROSTATE_RECORDING_COMMON =4,  // запись: с передачей плагину пимп
      };

11. Mantis#408: Memory leak in struct MacroState.
    тыкс... перебор вышел с Work.locVarTable :-(
    Сам "Work.locVarTable" нужно удалять только в деструкторе.
    В остальных случаях - только содержимое таблицы.

12. Mantis#0000433: Updated operator new in new.cpp

t-rex 08.12.2007 18:03:05 +0200 - build 2305

1. Mantis#408: Memory leak in struct MacroState.

2. Коррупция хипа при удаление несуществующих макросов.

3. Некорректное сохранение REG_MULTI_SZ макросов.

svs 06.12.2007 18:45:58 +0300 - build 2304

1. Mantis#407: Memory leak in CommandLine class.

2. Начудил в 2298 с парсером... хотел как лучше, но не все учел...
   вернем обработку токенов tMinus (унарный минус) и tNot ("!") обратнов в prim()

3. 2 новых эвента для панельного плагина: FE_GOTFOCUS и FE_KILLFOCUS
   Параметр Param для ProcessEvent равен NULL.
   В соответствии с этим переделан механизм (очередность) посыла событий - сначала Gotfocus, а потом остальное.
   Для этого в SetPluginMode() добавлен параметр SendOnFocus


4. В билде 2301 забыл в config.cpp для TechInfo#48 поправить дефолтное значение UseNumPad на 1

5. Mantis#0000414: Handle leak in FileEditor::LoadFile()

6. В диалогах, сразу после DN_INITDIALOG приходит DN_GOTFOCUS для того элемента, который Focus=1

7. 2 новых эвента для редакторного плагина: EE_GOTFOCUS и EE_KILLFOCUS
   Параметр Param для ProcessEditorEvent равен EditorID.
   Для этого в класс FileEditor добавлена virtual функция OnChangeFocus.

8. Mantis#0000417: Memory leak in Viewer::ProcessKey()

9. Mantis#0000418: Wrong memory copy function used in TArray<Object>::Pack()

10. Mantis#0000419: Wrong memory copy function used in ScreenBuf::Scroll(int Num)

11. Mantis#0000420: INVALID_HANDLE_VALUE used in FindClose() in ScanTree::GetNextName()

drkns 04.12.2007 19:55:33 +0200 - build 2303

1. Мелкий глюк в 2302.

drkns 04.12.2007 18:51:36 +0200 - build 2302

1. Mantis#0000409: User Menu (F2) doesn't handle process INS key when Opt.UseNumPad == 1
   Также поправлено в истории строк ввода, ссылках на папки, фильтрах и ассоциациях.

svs 04.12.2007 09:18:57 +0300 - build 2301

1. Mantis#0000403: Not initialized variable used in MessageRemoveConnection()

2. Mantis#0000402: Handle leak in History::SaveHistory()

3. Mantis#0000404: Handle leak in CopyKeyTree()

4. Mantis#0000401: Handle leak in ProcessGlobalFileTypes()

5. Mantis#0000354: Goto dialog in editor
   Здесь сделано не так, как хотелка звучит.
   Добавлен флаг DIF_NOAUTOCOMPLETE

6. TechInfo#48 по умолчанию делаем 1, а для Numpad5 TechInfo#48 игнорируем.

7. Mantis#0000331: ...
   про комбобокс; уточнение:
   - корректировка Top`а
   - динамическое изменение открытого выпадающего списка (Hide+Show)


t-rex 04.12.2007 00:10:10 +0200 - build 2300

1. Глюкс с некоторыми менюшными макро-функциями, могли сработать вне меню.

drkns 03.12.2007 20:20:28 +0200 - build 2299

1. Mantis#0000364: Maximize button doesn't work as expected
   Попробуем с другой стороны :-)
   Теперь работает "as expected" (кнопка, даблклик по заголовку, Maximize/Restore в системном меню и т. п.)
   Также учитывается состояние окна консоли при старте (start /max, настройка в lnk и т. п.)

svs 26.11.2007 12:15:19 +0300 - build 2298

1. В copy.cpp вынес описание 2-х переменных за цикл, иначе Борманд
   грубо матерится.

2. Добавлена функция HiText2Str (аля HiText, но в строку)

3. Macro: добавлена функция N=Menu.Select(S). Позиционирует
   на первый пункт, содержащий подстроку S. Поиск подстроки ведется
   с конца строки пункта меню. Если такого пункта нет, ничего не делает.
   Возвращает: 0=ошибка при позиционировании (нет пункта или пункт
   задисаблен), иначе - позицию пункта меню.
   F11 $if(Menu.Select("Advanced compare") > 0) Enter $end

4. Macro: Добавлена в коллекцию функция n=mod(n1,n2) == (n1 % n2).

5. Macro: Расставим приоритеты в арифметике (аля Це, syntax.cpp):

     Унарные (R->L):          !  ~  -
     Бинарные арифметические: * /
     Бинарные арифметические: + -
     Сдвиг:                   << >>
     Сравнение:               < <= > >=
     Сравнение:               == !=
     Битовая:                 &
     Битовая:                 ^
     Битовая:                 |
     Логическая:              &&
     Логическая:              ||


svs 19.11.2007 11:54:22 +0300 - build 2297

1. Mantis#0000358: Для элемента "точки" PluginPanelItem.UserData всегда 0

   [-] API: Для элемента ".." в PluginPanelItem заполнялись только поля
       FindData.dwFileAttributes и FindData.cFileName, остальные элементы
       структуры обнулялись.

yjh 16.11.2007 06:58:33 +0300 - build 2296

1. В операции Move при включенной фильтрации не удалялся полностью
   скопированный каталог

2. В операции Move при включенной фильтрации пустые каталоги не копировались
   даже если они соотвествуют фильту


yjh 16.11.2007 00:16:50 +0300 - build 2295

1. В правке фильтров исключений не учитывался запрет на фильтрацию каталогов


drkns 15.11.2007 20:04:49 +0200 - build 2294

1. Ещё одна небольшая правка с овнерами.


yjh 15.11.2007 04:01:15 +0300 - build 2293

1. Доделка фильтров "исключения" при копировании в отношении каталогов.
   Если при копировании включена фильтраци, то в отношении "разрещающих"
   фильтров всё работает как раньше. В отношении же "запрещающих" (-) фильтров,
   если встречается каталог подпадающий под действие фильтра, то пропускается
   и он и всё его содержимое


drkns 14.11.2007 20:12:45 +0200 - build 2292

1. В режиме отображения овнеров не работало кеширование и не освобождалась память.

2. К типу колонки "владелец файла" можно добавлять флаг 'L' - отображать домен.


yjh 14.11.2007 21:22:04 +0300 - build 2291

1. В FarMkTempEx убрана (потенциальное) некорреткое формирование имени
   (при слишком длинном пути). Теперь в такой ситуации возвращается ошибка

2. В WipeDirectory был некорректный код ошибки (при невозможности сформировать
   временный файл)

3. В WipeDirectory переименование сделано именно переименованием (inplace)
   вместо "перемещения". Это дешевле, исчезает ошибка "восстановления" (при
   невозможности удаления и ответе Skip оставались частично переименованные
   каталоги, да ещё и не всегда на своём месте :), меньше вероятность нарваться
   на "забитость" каталога (при генерации имени временного файла).
   Ну и, в досе (dw32) работает :)


yjh 13.11.2007 09:44:34 +0300

1. Возможность компилировать хук vc7 (для извращенцев :). Очень рекомендую
   в этом случае омпилировать определив -DLINK_WITH_ULINK и компоновать
   ulink'ом. В противном случае, работать-то будет, но меньше степень
   защиты :). О чём будет сообщение при компиляции :)


yjh 13.11.2007 02:58:03 +0300 - build 2290

1. Hook позволяющий 32хбитовому Far'у корректно работать с FS в Win64
   (отключение WOW64-fs redirection). По умолчанию оно отключено и
   включается только на моменты загрузки DLL/запуска задач (для "штатной"
   работы 32хбитовых процессов).
   При желании собрать Far без этого кода следует определить (для make)
   DISABLE_WOW64_HOOK.
   Корректно это будет компоноваться (и, как следствие, работать) либо
   ms-link не ниже чем от vc8, либо ulink версии >= 1.05 build 3.9 (лучше
   использовать build >= 3.11 - иначе будет ненужное информационное сообщение).


svs 12.11.2007 13:02:03 +0300 - build 2289

1. Падает FAR в следующих ситуациях:

   a) Запущен FAR без макросов в реестре
   b) Запущен FAR с макросами в реестре но запущен как Far.exe /m
   c) Запущен FAR с макросами но их удалили во время сеанса FAR и вызвали плагин UpdateMacros.dll

   когда падает:

   Ctrl. Ctrl. Любая_допустимая_клавиша Enter
   FAR упал

2. Пусть у нас есть 2 макроса:
   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Shell\F10]
   "Sequence"="F5"
   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Common\F10]
   "Sequence"="F4"

   запускаем FAR
   находясь на панели жмем Ctrl. Ctrl. F10
   выбираем "ДА"

   ещё раз делаем Ctrl. Ctrl. F10
   выбираем "ДА"

   жмем F10 и видим макрос не снялся если ещё раз сделать Ctrl. Ctrl. F10
   нам опять предлагает удалить...

   те макрос (общий) в такой ситуации не снимается


t-rex 09.11.2007 22:04:18 +0200 - build 2288

1. Исправил ещё одни недочёт в АПЙ для x64 версии. Надеюсь что это последний.

svs 09.11.2007 11:50:32 +0300 - build 2287

1. В InfoList вместо Text используем BoxText

2. TVar вынесен в отдельный модуль tvar.?pp + компилятор из macro.cpp в syntax.cpp

3. KeyNameToKey теперь для макроязыка возвращает -1.

4. GetMacroParseError - теперь функция класса Macro.

5. После 2280 пункт 6 отвалился $MMode.
   Теперь $MMode будет компилится по правилам...
   т.е. если раньше было для "$MMode 1":
     0: MCODE_OP_MACROMODE
     1: '1'
   то теперь все встало на свои места:
     0: MCODE_OP_PUSHINT
     1: HIDWORD(1)
     2: LODWORD(1)
     3: MCODE_OP_MACROMODE

6. Mantis#0000351: ACTL_POSTKEYSEQUENCE: пауза при выполнении и лишняя перерисовка


zg 05.11.2007 11:33:59 +0200 - build 2286

1. снова собирается gcc.

2. Траблы с...
     > есть 2 макроса
     > а) в области shell Ctrl-CapsLock=CtrlShiftTab flock(1,2)
     > б) в области редактора Ctrl-CapsLock=CtrlShiftTab flock(1,2)
     >
     > 0. в shell открыли файл в редаторе, переключились снова в shell
     > 1. нажали Ctrl-CapsLock, у нас таки есть макрос, макрос запускается
     > 2. макрос отработал, в конце саданул в очередь Up-Down для VK_CAPITAL (тот самый flock(1,2))
     > 3. макрос закончился, но:
     > 3.1 состояние Ctrl - в "нажато"
     > 3.2 на подходе Up-Down для капслоск
     > 4. ФАР видит в очереди CtrlCapsLock, проверяет, что мы в редакторе, а там такой же макрос тоже есть - начинает работать макрос
     > 5. goto п.2
     >
     > Помогает только кнопка на морде системного блока

   исправлено зависание. но так как во время физического нажатия *Lock программно изменить состояние этого самого *Lock нельзя, то макросы надо чуть доработать:
   CtrlCapsLock="CtrlShiftTab %a=flock(1,-1)&1; $while((flock(1,-1)&1)==%a) sleep(50) flock(1,2) $end"

svs 01.11.2007 14:34:29 +0300 - build 2285

1. Mantis#0000344: Ключи для отключения при запуске макросов / автостартующих макросов
   [+] Добавлены параметры командной строки:
       /m - при старте FAR не будет загружать макросы из реестра
       /ma - при старте ФАР не будет исполнять автостартующие макросы.

2. Падение, если в поисковике файлов в качестве маски указать "*.*, ,*.*"

3. В Хелпе FarEng.hlf.m4 есть русские буковки!
   В очередном патче кто-нить исправьте сей недостаток :-)

svs 27.10.2007 18:25:11 +0300 - build 2284

1. Macro: Падение при записи последовательности с клавиатуры.

2. Вернем обратно KEY_MACRO_BASE в разряд "клавиш".
   Есть проблемы.

t-rex 27.10.2007 19:36:14 +0200 - build 2283

1. Оптимизация вывода строк редактора на экран, очень ощутимо на очень длинных строках.

2. Убрал SHITHAPPENS за ненадобностью.

svs 27.10.2007 15:35:43 +0300 - build 2282

1. Добавлен MCODE_OP_NOP

2. Уточнения кода по поводу падения во время удаления макроса
   и/или воспроизведенния...

3. Убрал "if(GetRegKey("System","TestLock",0) == 0)"

svs 27.10.2007 13:04:05 +0300 - build 2281

1. Уточнение макро...

svs 24.10.2007 19:34:54 +0300 - build 2280

1. MCODE_OP_EXPR и MCODE_OP_DOIT удалены как класс.

2. KEY_MACRO_BASE ... KEY_MACRO_ENDBASE ужО не "клавиши"!
   Остались только KEY_OP_*, кторые являются "клавишами"

3. В логирование добавлен _MOUSE_EVENT_RECORD_Dump()

4. Изменена SetFLockState
   GetKeyboardState отстой, работает только в дебажной версии (вот ить!)
   вместо нее юзаем нашу GetKeyState()

5. Хмм... а, ну да, оп-коды макросов теперь навинаются с 0
   (небольшое приближение к...)

6. В парсере макросов.
   между MCODE_OP_KEYS и MCODE_OP_ENDKEYS находятся настоящие клавиши!
   сейчас можем наблюдать фигню типа когда parseMacroString() каждую
   "настояшую клавишу" обрамляет этими кода (избыток!), но
   это промежуточный этап....
   В конце будет отдельный DLL, который ФАРу будет отдавать только байткод.

7. В PostNewMacro() добавлен новый параметр...
   предполагается (сейчас!), что плагины "пидалят" макросы с чистыми
   кодами клавиш!
   Но т.к. эта функция испльзуется не только для плагинов, то...
   ...нужно отличать "где мы".

8. В FarDialogEx остался ошметок вида
   if(GetRegKey("System","TestLock",0) == 0)
   надо запомнить...


9. Траблы с...
     есть 2 макроса
     а) в области shell Ctrl-CapsLock=CtrlShiftTab flock(1,2)
     б) в области редактора Ctrl-CapsLock=CtrlShiftTab flock(1,2)

     0. в shell открыли файл в редаторе, переключились снова в shell
     1. нажали Ctrl-CapsLock, у нас таки есть макрос, макрос запускается
     2. макрос отработал, в конце саданул в очередь Up-Down для VK_CAPITAL (тот самый flock(1,2))
     3. макрос закончился, но:
     3.1 состояние Ctrl - в "нажато"
     3.2 на подходе Up-Down для капслоск
     4. ФАР видит в очереди CtrlCapsLock, проверяет, что мы в редакторе, а там такой же макрос тоже есть - начинает работать макрос
     5. goto п.2

     Помогает только кнопка на морде системного блока

   Вся надега на zg! :-)


svs 22.10.2007 17:42:08 +0300 - build

1. Добавка некоторого количества писаний (без билда)


Zuz 22.10.2007 12:07:01 +0500 - build 2279

1. Mantis#000337: сразу не обновлялась панель с открытой на ней шарой при удалении одного файла
даже когда её просили по UIC_UPDATE_FORCE

svs 18.10.2007 21:55:19 +0300 - build 2278

1. Editor: Падает, гад.
   Имеем файл (символ '*' - обозначим концы строк)
     +----------------------+
     |1 2 3*                |
     |3 4 5 6*              |
     |*                     |
     +----------------------+

   настройки редактора:
    [x] Persistent blocks
    [ ] Del removes blocks
    [x] Cursor beyond end of line

   Последовательность действий:
     Выделяем символ '6'
     End
     Del
     Up
     Del
     упали.

   В Editor::DeleteString() после "BlockStart=BlockStart->m_next;" не
   проверялся  BlockStart на NULL, но был вызов "BlockStart->IsSelection()".

2. Добавлена обработка клавиш NumLock, CapsLock, ScrollLock с модификаторами.
   Про них отдельно :-)

3. Macro: добавлена функция FLock()
    N=FLock(Nkey,NState)
       Nkey:
          0 - NumLock
          1 - CapsLock
          2 - ScrollLock

       State:
         -1 get state
          0 off
          1 on
          2 flip

     Windows NT/2000/XP: The keybd_event function can toggle the NUM LOCK, CAPS LOCK, and SCROLL LOCK keys.
     Windows 95/98/Me:   The keybd_event function can toggle only the CAPS LOCK and SCROLL LOCK keys. It cannot toggle the NUM LOCK key.


4. Небольшая перетасовко-перегруппировка кода в macro.cpp


svs 15.10.2007 12:48:31 +0300 - build 2277

1. Ctrl-: и Ctrl-Alt-: - приводим к соответствию, к Ctrl-; и Ctrl-Alt-;

2. Bug: Во вьювере при отключенном постоянном выделении после внесения
        воздействия выделение не снимается.

3. Mantis#0000303: Названия кнопкосочетаний с модификаторами
   Обнаружилась ещё одна нерегулярность в том же духе: ` vs ~

svs 15.10.2007 11:22:50 +0300 - build 2276

1. Снова 2269 :). Правда уже во вьювере.
   ViewY1 теперь ненужна (была нужна только на тот случай, когда Viewer учитывал статусную строку)
    "...если вьювер окрывается сразу в hex,... первая строка за статусной скрыта... не достанешь"


t-rex 13.10.2007 20:24:26 +0200 - build 2275

1. Снова 2269 :), после CtrlY на предпоследней строке в файле (если файл
   занимает больше чем один экран) неправильно выставлялся TopScreenLine.

2. Прошелся по всем местам где есть Y2-Y1, нашел ещё одно место где теоретически могло глючить.
   Бум надеяться что больше 2269 о себе не даст знать.

t-rex 13.10.2007 19:33:13 +0200 - build 2274

1. 2269 всё ещё даёт о себе знать, очень заметно на примере плагина Visualizer (CtrlEnd или Down на нижней строке).
   Есть предчувствие что это не последний раз.

svs 12.10.2007 14:32:05 +0300 - build 2273

1. Mantis#0000206: Некорректная работа переноса по словам в "Программе просмотра"
   как я и подозревал - кривая инициализация строки.

2. Mantis#0000335: Нельзя набрать символ ']'
   Опираясь на фразу из хелпа
   "Кроме обычных символов в имени файла также можно использовать символы '*' и '?'"
   сделаю грязный хак :-)
   1. В XXX::FindPartName() добавляем параметр ExcludeSets, который говорит о том,
      чтобы не учитыват наборы (в квадратных скобках)
   2. Т.к. юзается CmpName(), то пере ее вызовом изменим маску поиска, заменив
      '[' на '[[]' и ']' на '[]]':

       ReplaceStrings(Mask,"[","<[%>",-1,1);
       ReplaceStrings(Mask,"]","[]]",-1,1);
       ReplaceStrings(Mask,"<[%>","[[]",-1,1);

      '<[%>' - это типа "уникальная последовательность", наличие которой в оригинальной
               маске как бы не должно быть.
               без нее получим кривизну, если заюзаем

                 ReplaceStrings(Mask,"[","[[]",-1,1);
                 ReplaceStrings(Mask,"]","[]]",-1,1);

               второй реплейс криво отработает.

3. Уточнение в хотплюгах по поводу хилайта

svs 12.10.2007 11:00:20 +0300 - build 2272

1. В 2269 забыл про АПИ (это про "Editor должен работать в пределах X1,Y1,X2,Y2...")

2. Mantis#0000303: Названия кнопкосочетаний с модификаторами
   Ctrl-" и Ctrl-: забыл...

3. Mantis#0000326: QView, Info: ItemCount, CurPos, Selected, Bof, Eof всегда 0; Empty всегда 1
   Теперь: Bof/Eof/Empty/Selected - если в панелях, но в QView/Info/Tree, то возвращается
   значение для этих типов панелей, иначе - для ком.строки.

4. API: ListBox не реагировал на выбор мышкой, если был выставлен режим LMRT_NEVER.

5. Macro: Добавлен MacroArea - возвращает имя текущей макрообласти.

6. Alt-Shift-F9 - не сохранялось значение опции "Lock editing of read-only files"

svs 11.10.2007 11:29:16 +0300 - build 2271

1. Mantis#0000106: Экран уезжает вправо после PgDn

   [-] Некорректное отображение экрана редактора при выключенной опции
       "Курсор за пределами строки" ("Cursor beyond end of line")

   Проблема в следующем. Сначала код.

   Editor::ShowEditor
     if (!EdOpt.CursorBeyondEOL)
     {
       CurLine->SetLeftPos(0);
       Здесь LeftPos =  0
   (а)>>  CurLine->FastShow();
       Здесь LeftPos != 0
     }

   Edit::FastShow()
   (б)>>  EditLength=ObjWidth;

    if (!Flags.Check(FEDITLINE_DROPDOWNBOX))
    {
      if (TabCurPos-LeftPos>EditLength-1)
        LeftPos=TabCurPos-EditLength+1;
      if (TabCurPos<LeftPos)
        LeftPos=TabCurPos;
    }

   Теперь описание :-)
   1. Начинаем открывать файл в редакторе.
   2. Читаем построчно, создавая при этом связанный список строк
      (используется Editor::CreateString)
   3. Т.к. класс Edit основан на ScreenObject, то ObjWidth=0
   4. в (б) EditLength=0
   5. ...
   Когда по строкам "пробежались", то... ObjWidth нормализуется
   и в последующем для этого открытого файла баг пропадает.

   Делаем следующее. В Editor::CreateString задаем изначальное значение
   X1 и X2 (Y1 и Y2 нам здесь на этом этапе ненужен)


svs 09.10.2007 20:29:26 +0300 - build 2270

1. Mantis#0000333: Не работает Lock editing Read-only files
   напутал с логикой.

svs 08.10.2007 18:02:22 +0300 - build 2269

1. Editor должен работать в пределах X1,Y1,X2,Y2. В коде замечем-то есть коррекция
   на статусную строку, за которую должен отвечать FileEditor.
   Как побочный эффект:
   [+] Комбинация Ctrl-Shift-B в редакторе и программе просмотра показывает или
   скрывает статусную строку.


svs 13.09.2007 19:34:02 +0300 - build 2268

1. Mantis#0000327: [X] Save bookmarks не работает без [X] Save file position
   Сделаем автоблокировку второго пункта (Save bookmarks), т.к.
   он сейчас зависим от первого.

2. В диалоге настройки вьювера небольшие изменения:
   - постоянное выделение уехало вверх (чтобы быть похожим на конфигурирование редактора)
   - по аналогии с настройками редактора "Save bookmarks" уехал вверх-вправо
   - та же сама автоблокировка пункта "Save bookmarks"

3. API: добавлены DM_SETCOMBOBOXEVENT и DM_GETCOMBOBOXEVENT.
   позволяют управлять (FARCOMBOBOXEVENTTYPE) посылкой событий клавиатуры и мыши
   в диалоговую процедуру для открытого комбобокса.

4. API: Для элемента DI_COMBOBOX теперь в ответ на сообщения DM_LIST???? строка
   редактирования не изменяется при навигации по элементу.


svs 07.09.2007 19:44:58 +0300 - build 2267

1. Mantis#0000293: Дополнение DI_COMBOBOX
   [+] API: Добавлены события DN_KEY или DN_MOUSEEVENT, которые посылаются
       в процедуру обработки диалога при навигации по DI_COMBOBOX

svs 07.09.2007 09:23:12 +0300 - build 2266

1. Mantis#0000303: Названия кнопкосочетаний с модификаторами
   [*] Macro: Изменены названия сочетаний клавиш с модификаторами:
       вместо `:` теперь `;`, а вместо `"` теперь `'`. Это относится
       ко всем комбинациям модификаторов, кроме одиночного Shift.

svs 06.09.2007 15:47:01 +0300 - build 2265

1. "Не удалось открыть файл" -> "Ошибка открытия файла"
   уже не помню какой-там мантис...

2. Другой вариант переключения раскладки в XLat и $KbdSwitch
   (взято с форума)


Zuz 05.09.2007 01:13:26 +0500 - build 2264

1. For elimination of effects of Vista virtualization technology the manifest file has been added

warp 01.09.2007 20:40:00 +0300 - build 2263

1. Пока разбирался с 1.80 нашел глюк в верхнем меню, было обращение к несуществующему
   пункту.


svs 30.08.2007 19:07:12 +0300 - build 2262

1. 0000324: GetHotkey() возвращает "0"
   [-] Macro: Если пункт меню не содержит горячую клавишу, то GetHotkey() возвращает "0" вместо ""

2. 0000325: $SelWord выделяет лишнее знакоместо в конце строки
   [-] Macro: $SelWord выделяет лишнее знакоместо в конце строки

3. 0000326: QView, Info: ItemCount, CurPos, Selected, Bof, Eof всегда 0; Empty всегда 1
   [-] Macro: В панелях быстрого просмотра и информации не работали некоторые переменные:
       ItemCount, CurPos, Selected, Bof, Eof всегда 0; Empty всегда 1.

4. Код возврата функций VMProcess теперь будет __int64


yjh 28.08.2007 14:49:21 +0300 - build 2261

1. Issue 313, У форточек сносит крышу при попытке сделать
   GetFileAttributes("..") когда находишься в корне UNC-заданного диска.

t-rex 24.08.2007 20:56:11 +0200 - build 2260

1. Добавил форматирование чисел в меню дисков (размеры дисков Ctrl-5).

svs 24.08.2007 18:14:25 +0300 - build 2259

1. Mantis#0000318: Опция - Восстановить размеры панелей
   Добавлена комбинация для панелей Ctrl-Shift-Num5 - "по высоте"
   размеры панелей будут восстановлены до Командной строки

svs 24.08.2007 14:16:22 +0300 - build 2258

1. Упс (пред патч). А вот VMENU_LISTBOX для Комбобокса и не нужен!
   (т.к. открисовка раскрытого DI_COMBOBOX может выходить за пределы диалога)

2. Mantis#0000316: Не работает копирование строки

3. Mantis#0000259: Выделить до первой/последней строки

svs 24.08.2007 14:01:18 +0300 - build 2257

1. Баг в диалоге (http://forum.farmanager.com/viewtopic.php?p=26515#26515)
   юзер нажал F4 {
     диалоговый менеджер послал плагину DN_KEY, F4 {
       плагину послал DM_CLOSE {
          диалоговый менеджер погасил диалог и приготовил всё необходимое
          для удаления внутренних элементов и т.п., т.с. Leave
       }
     }
     управление вернулось в менеджер и он продолжил анализ клавиши,
     дошел до комбобокса и послал клавишу строке редактирования
     (комбобокс состоит из 2-х обхектов!), та вязала и перерисовалась
   }


Zuz 24.08.2007 15:26:14 +0500 - build  2256

1. Не работал KEY_DECIMAL при UseNumPad=0.

2. Для Win9x не добавлялись модификторы для точки на цифровой клавиатуре (видно в диалоге назначения клавиши макросу).

svs 14.08.2007 14:09:59 +0300 - build 2255

1. NumDecimal не отрабатывал в редакторе

2. Внутренние добавки для проекта "Флаги редактора"

3. Уточнение билда в plugin.hpp (про _FAR_USE_WIN32_FIND_DATA)

t-rex 12.08.2007 20:01:15 +0200 - build 2254

1. Для форматирования чисел (InsertCommas и т.п.) теперь используем настройки винды
   а не железно прописаные запятую и точку.


Zuz 12.08.2007 22:18:09 +0500 - build 2253

1. Опять Mantis#0000176 не доконца перенёс патч, вообще артефактов при обновлении
панелей на медленных соединениях хватает, кто бы занялся ;-)

Zuz 11.08.2007 16:48:06 +0500 - build 2252

1. Mantis#0000176: Двойное сканирование после cd path, логический фикс

svs 07.08.2007 14:31:26 +0300 - build 2251

1. Mantis#0000309: DM_LISTSETMOUSEREACTION с флагом LMRT_NEVER - не приходят клики мыши
   Двойной клик мыши просто не учитывался. добавил.

svs 07.08.2007 12:50:22 +0300 - build 2250

1. Mantis#0000310: Сброс сохраненной позиции во View'ere
   бага стара как мир... :-(

2. В setattr.cpp косметика - для удобоваримости и понятности имен переменных.

3. viewer.cpp - принудительная очистка массива BMSavePos.

4. Macro: макросы, назначенные на Модификаторы+Decimal записывались, но не
   воспроизводились.

5. Mantis#0000158: _FAR_USE_FARFINDDATA и Релиз 1.70
   Вместо _FAR_USE_FARFINDDATA теперь используется _FAR_USE_WIN32_FIND_DATA
   Соответственно - по умолчанию юзается FAR_FIND_DATA (для плагинов!)

svs 24.07.2007 21:41:04 +0300 - build 2249

1. Mantis#0000073: Не работает автоскролинг в QView

   WaitInMainLoop - "мы в основном цикле (в панелях)?". Если в панелях,
   то в GetInputRecord() не пашет механизм "холостого пробега" (if (WaitInMainLoop))
   Посему, для QView недостаточно проверки на панели - IsPanelsActive().
   Уточним сей факт.

2. Для раздела "@Viewer" в хелпах добавлена информация об автоматическом скроллинге.
   (В FarEng.hlf.m4 появились русские буковки!!!)

svs 23.07.2007 15:57:29 +0300 - build 2248

1. Добавка к Dialog API. DM_[S|G]ETEDITPOSITION - управление позицией сктроки в строках
   ввода в диалогах. Добавка к DM_[S|G]ETCURSORPOS.
   В качестве Param2 принята структура EditorSetPosition, чтобы в будущем команды так же
   работали и на MI_MEMO.

t-rex 21.07.2007 01:01:04 +0200 - build 2247

1. В режиме колонки NR AltHome не прокручивал строки в начало.
   По идеи это был баг но например в режиме NR,Z этот "баг" давал возможность вернутся
   к оригинальному выравниванию после того как покрутили (чего теперь незя сделат)
   но вроде это все ровно баг.


svs 09.07.2007 14:59:19 +0300 - build 2246

1. [-] Macro: не работали конструкции Eof/Bof/etc в программе просмотра.


yjh 08.07.2007 08:15:34 +0300 - build 2245

1. Для поиска файлов признак использования фильтра запоминается в registry


t-rex 07.07.2007 22:47:44 +0200 - build 2244

1. Что то стал не внимательным. Ещё мелкое дополнение к предыдущему фиксу.
   Даже если вышли из меню фильтров по Esc то все ровно юзер мог добавить
   пару новых фильтров но в таком случае в реестр они не попадали.


t-rex 07.07.2007 21:24:29 +0200 - build 2243

1. В дополнение к 2234, сохраняем фильтры только если AutoSaveSetup или юзер нажал Shift-F9.
   Это вписывается в общюю логику работы с реестром у фара.


svs 06.07.2007 14:15:29 +0300 - build 2242

1. Mantis#0000304: DM_LISTGETCURPOS для отмененного комбобокса.
   Блин, перебор в трех местах вышел...

svs 05.07.2007 16:53:14 +0300 - build 2241

1. Mantis#0000289: прорисовка сообщения обрезана при выволнении макро

2. Mantis#0000304: DM_LISTGETCURPOS для отмененного комбобокса.

svs 05.07.2007 11:33:41 +0300 - build 2240

1. Mantis#160 - Хочется F3 и F5 на дисках.
   В обчем репорт извернули в сторону Macro.gethotkey() :-)

   S=gethotkey(N)
   где N - нужная позиция в списке от 1 (0 - текущая)
       S - либо "", если хоткея нет или N > количества пунктов в меню или это не меню;
           иначе S = сам хоткей.

Zuz 03.07.2007 14:10:47 +0500 - build 2239

1. Mantis#223 - вернул возможность уставливать дату/время для каталогов на FAT/FAT32
   локальных дисков под WinNT+ (нужно для тех же флешек, например), для сетевых дисков
   ошибка теперь тихо игнорируется.

warp 28.06.2007 05:33:00 +0300 - build 2238

1. Крайней экспериментальный фикс. Из PluginsSet::OpenPlugin убрано выставление
   текущей папке, не похоже, что оно реально требуется, но оно порождает ситуацию,
   когда текущей оказывается неверная папка (когда в плагине текущая папка
   имеет такое же имя, как реально существующая).


yjh 28.06.2007 01:46:29 +0300 - build 2237

1. Убрана ошибка "переполнения" в рассчётах времени/скорости при копировании
   и изменена (упрощена) логика учёта времени ожидания ответов пользователя
   в ситуации ошибок при копировании.
   Сейчас общее время операции учитывает время ожидания, а оставшееся время
   и средняя скорость - нет.


svs 26.06.2007 20:11:04 +0300 - build 2236

1. Mantis#286 - Порча бинарных файлов при сохранении встроенным редактором.
   Mantis#295 - Пропуск символов при смешанных переводах строк

   пробуем...


svs 26.06.2007 19:35:03 +0300 - build 2235

1. Mantis#287 - Не воспринимаются переменные начинающиеся с цифр


t-rex 26.06.2007 14:51:33 +0200 - 2234

1. Перед сохранением фильтров панели не будем вытирать сразу всю ветку
   Filters из реестра а только то что надо.


t-rex 25.06.2007 06:00:50 +0200 - 2233

1. Mantis#0000275: В диалогах при обработке DIF_CENTERGROUP выставлялся
   X1 но не X2 что приводило к проблемам как минимум с DI_TEXT так как
   недавно для него стал учитыватся также и X2.


svs 31.05.2007 20:11:24 +0300 - build 2232

1. Macro: добавлена функция Panel.SetPosIdx - позиционирование
   на файловой панели по индексу.

2. В WaitKey добавлена задержка на 50ms - иначе при CAS наблюдается
   повышенная "возбужденность" FAR`а в таскманагере.

svs 15.05.2007 10:25:29 +0300 - build 2231

1. Macro: имена переменных, начинающихся с числа не воспринимаются.
   Например, %3Proc.

svs 11.05.2007 22:38:00 +0300 - build 2230

1. Для "System/UseNumPad=1" НЕ понадобятся макросы, т.к.
   все продублировано.

2. Mantis#0000285: $SelWord не работает в dos-кодировке

svs 11.05.2007 15:30:50 +0300 - build 2229

1. Mantis#0000232: Различать Del и NumDel, Enter и NumEnter
   Для "System/UseNumPad=1" понадобятся макросы:

   REGEDIT4

   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Common\NumEnter]
   "Sequence"="Enter"
   "DisableOutput"=dword:00000001

   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Common\CtrlNumEnter]
   "Sequence"="CtrlEnter"
   "DisableOutput"=dword:00000001

   [HKEY_CURRENT_USER\Software\Far\KeyMacros\Common\ShiftNumEnter]
   "Sequence"="ShiftEnter"
   "DisableOutput"=dword:00000001

   Появились новые клавиши: NumEnter, Decimal/NumDel (в зависимости от состояния
   NumLock)

2. macro:post eval("AltF1") не работал; конструкция превращалась в Alt00000



svs 10.05.2007 14:24:51 +0300 - build 2228

1. Macro: добавлены функции asc и chr.


svs 08.05.2007 15:34:05 +0300 - build 2227

1. Забыл в прошлый раз про Automation в диалоге SystemSettings

2. "TreeFileAttr" можно задавать. По умолчанию FA_HIDDEN.

3. В farconst.hpp до бавлены закомменченные определения DRIVE_*

4. Macro: PlayMacro переименован в Eval и в нем же обнаружена бага -
   нужно снимать флаг MFLAGS_REG_MULTI_SZ перед парсением...


t-rex 24.04.2007 22:04:06 +0200 - build 2226

1. Начинаем понимать вистовые симлинки. Ещё не доделано но хоть что то :)
   GetPathRoot не в 100% работает как надо из за относительных линков,
   надо подумать как нормально сделать.


svs 24.04.2007 20:21:07 +0300 - build 2225

1. Mantis#279 - Редактор не позиционируется на новый файл после сохранения
      macro:post ShiftF4 1 Enter F2 CtrlF10 Esc
      не позиционирует на созданный файл

   В обчем вроде как... но при большом объеме каталога будут тормоза.
   Здесь проблема в том, что поиск файла ведет на VFS (на панели), а т.к.
   панель еще не апдейтилась, то, соответственно про этот новый файл
   ни кто ничего не знает.

2. Bug с удалением в корзину с последующей очисткой.
   Напихали в каталог симлинков. Грохнули каталог в корзину.
   Теперь, если корзину очистить, то киляется все, что было в этих
   симлинках.
   Здесь тупо вводим опцию "Delete symbolic links". Если она включена,
   то перед килянием каталога в корзину сканим подпапки на предмет симлинков
   и эти самые симлинки удаляем.
   Говорят Виста в этом плане умнее будет - ХЗ, поверим на слово, но мезханизм
   сканирования все же оставим :-)

   Здесь затронуты хелпы - нужен перевод!

svs 23.04.2007 15:40:24 +0300 - build 2224

1. MFLAGS_LABELPRESENT - в морг. вместо него будет MFLAGS_REG_MULTI_SZ

2. +API::FARKEYSEQUENCEFLAGS::KSFLAGS_REG_MULTI_SZ

3. Как следствие - Sequence может иметь тип REG_MULTI_SZ.

4. Небольшая добавка в виде операторов ">>" (shr) и "<<" (shl)
   У них приоритет такой же как и у "+" и "-".

5. Отучение от внутреннего цикла для MCODE_OP_EXPR.
   Теперь MCODE_OP_EXPR и MCODE_OP_DOIT пережитки прошлого.

6. В KeyMacro::FARPseudoVariable в паре мест были пропущены "break;"

7. В KeyMacro::GetKey - вместо MCODE_OP_LT (и подобных) нужно было
   MCODE_OP_JLT


svs 12.04.2007 21:39:13 +0300 - build 2223

1. Бага в обработчике KEY_OP_TEXTPLAIN в редакторе.
   забыл поправить MCODE_OP_PLAINTEXT на KEY_OP_PLAINTEXT

svs 10.04.2007 19:58:36 +0300 - build

Без билда. Добавлен файл "TODO"

t-rex 10.04.2007 17:41:18 +0200 - build 2222

1. В 2220 погорячился немного, вернул и переделал проверку для не добавления "..".


svs 09.04.2007 20:31:34 +0300 - build 2221

1. Bug: В обработчике MCODE_OP_SAVE сначала нужно вытащить из стека значение,
        а потом остальным заниматься.

2. Добавлены макросы логирования:
   SYSLOG_KEYMACRO_PARSE/_KEYMACRO_PARSE()  - для парсера макросов
   SYSLOG_YJH/_YJH()                        - для Харона :-)

3. Остальное по мелочам - антураж при логировании макросов, etc.


t-rex 08.04.2007 17:29:06 +0200 - build 2220

1. Mantis#263 - ".." не всегда красились (а точнее когда мы их добавляли в ручную).
   В дополнении к этому убрал одну лишнюю по моему мнению проверку для
   НЕ добавления ".." даже если FindFile его нашел - раз нашел значит надо, я так думаю.


svs 07.04.2007 14:39:06 +0300 - build 2119

0. В проект добавлены файлы TVMStack.cpp и TVMStack.hpp
   (реализация стека).

1. Нормальная реализация стека в макросах - был полный бардак,
   как работало раньше - ХЗ. Например, $Text брал текст из вершины
   стека, но не удалял из стека это значение...
   Это позволило решить проблему с кодом возврата PlayMacro и,
   на будущее, исключить некоторые новые баги.

2. Если при исполнении $Text в стеке ничего нет (например, макрос
  "$Text _"), то ничего и не исполняется.

3. В ряд классов добавлены функции XXX::VMProcess()

4. В клавиши добавлен блок KEY_OP_BASE.
   В него входят аналоги некоторых макроопераций, которые невозможно
   исполнять в VMProcess (например, придется дублировать код из
   ProcessKey).
   Имя таких аналогов начинается с KEY_OP_???
   Макродвижок сам подменяет макрокод на код нужной клавиши.

   Эта добавка (как и предыдущие и последующие) - небольшие
   продвижения к...
   ...конечная цель: макрокоды должны иметь свои коды, отличные
   от кодов клавишь.
   В будущем все обычные клавиши в байткоде будут ограничены кодами
   MCODE_OP_KEYS и MCODE_OP_ENDKEYS.

5. В редакторе добавлена обработка концов строк "\r\r\n"
   Увидеть такое чудо можно вот так:
     ping localhost > file.txt
   Сохранение (SaveAs) с таким окончанием строк не предусмотрен.


svs 04.04.2007 14:28:14 +0300 - build 2218

1. Бага - постоянно собрасывается на английский
   Как повторить:
   - Выбираем русский язык интерфейса и справки;
   - Язык нормально меняется;
   - Выходим из FAR (установлен крыжик "Автосохранение настроек");
   - Загружаем FAR - язык русский;
   - Выходим из FAR;
   - Загружаем FAR снова и видим, что язык сбросился в английскй. Язык справки при этом не сбрасывается.

svs 03.04.2007 20:30:55 +0300 - build 2217

1. Фигня была с языками.
   Например, убили FarEng.lng, в реестре при этом стоит Language/Main="English"
   Грузимся. Видим русский интерфейс.
   set FARLANG
   видим "English".

2. Mantis#0000092: Переопределение лейбов функциональных клавиш
   Ну, это фича, давно востребованная... В общем работает. :-)
   [HKCU\Software\Far\KeyLabels\ЯЗЫК\ОБЛАСТЬ]
   "ИМЯКЛАВИШИ"="Значение"

   Здесь
     ЯЗЫК       - так, как написано в LNG-файле, например,
                  English или Russian, т.е. тот, который в параметре
                  ".Language" идет первым после "=" и до ","
     ОБЛАСТЬ    - область действия в терминологии macro.
                  Понимаем области: Shell, Help, Edit, View, QView, Tree, Info
     ИМЯКЛАВИШИ - так, как они описываются в макросах.
                  Понимаются только функциональные "*F?" (что естественно :-))

3. Mantis#0000270: В показе установки атрибутов в пути до файла присутсвует SFN имена папок
   Хмм... что сказать, облажались. :-(
   Влиял параметр "System/FolderDeepScan", введенный в билде 2046, но не описанный.

   1.2.26.(TechInfo #76)
   ~~~~~~~~~~~~~~~~~~~~~
   [HKEY_CURRENT_USER\Software\Far\System]
   "FolderDeepScan":DWORD
   Параметр "System/FolderDeepScan" с типом DWORD позволяет обходить
   ограничения при работе с каталогами, в именах которых содержатся
   символы, некорректно преобразованные из ANSI в OEM.
   Если параметр включен (=1), то при обработке подобных каталогов будет
   произведена попытка получить информацию по короткому имени.
   Эта опция не влияет на работу механизма копирования.
   Может быть одним из следующих значений:
      0 - опция отключена;
      1 - так же использовать короткие имена;
   По умолчанию значение = 0 (работать только с длинными именами каталогов)


svs 02.04.2007 11:35:58 +0300 - build 2216

1. Функции GetFileDateAndTime, StrToDateTime и ReadFileTime
   вынесены в отдельный модуль timefunc.cpp
   А то расплодилось...

2. Про FarSprintf и еже с ним. Вернем. Для старого борманда (на остальные
   компилеры не влияет)

3. Macro: Легализация "$SelWord". Предполагалось несколько для других целей...

4. Macro: Локальная таблица переменных (типа TVarTable) теперь имеет отношение
   только к текущей области исполнения.

5. Macro: в panelitem добавлено 3 индекса - 15-17, соответствующие 3-5, но имеющие
   тип FILETIME (для макросов это __int64)


yjh 01.04.2007 13:41:11 +0300 - 2215

1. Добавлена уточнённая (более корректная) диагностика при слишком длинном
   (>MAX_PATH) полном имени файла, например, при попытке входа в каталог

2. Убраны последние предупреждения при компиляции vc8

yjh 31.03.2007 21:51:15 +0300 - 2214

1. Обойдён удар по памяти при подсчёте файлов в каталоге со слишком длинным
   полным именем (полученном через subst) [mantis:0000271]

yjh 31.03.2007 04:41:45 +0300 - 2213

1. Убрана ошибка перераспределения памяти в обработке макросов (проявлялось в
   x64 и - теоретически - в висте)

yjh 31.03.2007 03:17:21 +0300 - 2212

1. Убрана ошибка на закрытии при отсуствующих панелях (gpf) - возникало,
   например, при запуске с /r

t-rex 30.03.2007 05:59:00 +0200

1. Мелкие обновления в мэйке. Включил ворнинги о x64 совместимости для всех видов сборок.


t-rex 30.03.2007 01:38:50 +0200 - 2211

1. PluginNumber в plugin.hpp теперь INT_PTR - нужно это сугубо на будущее
   для работы 1.7x x64 плагинов под будущим врапером в 1.80.
   Внутри фара всё осталось как и было, изменение чисто наружное.
   x64 плагины требуется пересобрать.

2. Убил последний ворнинг.


yjh 26.03.2007 06:48:19 +0300

1. Уточнение отмены "Перекрытых" ключей ulink в Far.mak

yjh 24.03.2007 02:28:48 +0300

1. Забыл убрать вывод замангленной мяпы ulink'ом


yjh 24.03.2007 02:25:19 +0300

1. Все компиляции с /W3 и убрано сохранение релокаций ulink'ом в w64


t-rex 23.03.2007 16:47:42 +0200

1. Несколько новых ключиков для улучшения размера exe.


t-rex 23.03.2007 01:57:32 +0200 - 2210

1. Напутал скобки в одном месте в прошлом билде.


t-rex 22.03.2007 19:53:58 +0200 - 2209

1. Пару мелких фиксов в системе сборки. В custom.*.bat больше не надо выставлять FARTRY.

2. Убрал ворнинги для VC32, VC64, GCC.

3. Из за 2 пофиксился ещё одни баг в x64 сборке - DialogParam внутри фара был long а не LONG_PTR.


yjh 21.03.2007 03:17:21 +0300

1. Косметические правки в manager.cpp (64бит, исключительно для читабельности :)
   и в этом файле - в заголовке не было номера билда

yjh 21.03.2007 00:17:21 +0300 - build 2208

1. Доделана сборка отладочных билдов vc8 (32/64), а так жк "по заявкам
   телезрителей" :) добавлена парочка ключей которая (потенциально)
   может дать выигрыш по размеру

2. Косметически правки в mkfar.mak (borland)

3. Сделана "нормальная" (без ассемблера кроме ud2 :) генерация исключений
   для ALPHA_VERSION

5. Добавлена "расшифровка" при exception по недопустимой/привелигированной
   инструкции

6. Для "нерасшифрованных" исключений выводится их код

7. Доделана нормальная отработка (показ) исключения по переполнению стека
   (и 32 и 64 бит версии)



yjh 18.03.2007 13:57:13 +0300

1. Доделки в сборке VC8 :) - убраны диагностики компилятора/линкера о
   устаревших ключах.

2. Добавлен возможность компоновать ulink'ом - см. readme

3. Добавлена возможность передавать опции nmake - см. readme



t-rex 15.03.2007 03:44:07 +0200 - build 2207

1. Собираемся под VC8 (проверял с WindowsSDK).

2. Из за 1 и вообще убрал
   int WINAPIV FarSprintf(char *buffer,const char *format,...);
   int WINAPIV FarSnprintf(char *buffer,size_t sizebuf,const char *format,...);
   int WINAPIV FarSscanf(const char *buffer, const char *format,...);
   так как не нужны, в FSF вставляются напрямую сами: sprintf, _snprintf, sscanf.


svs 14.03.2007 19:03:16 +0300 - build 2206

1. Mantis#268: ECTL_GETINFO может вернуть BlockStartLine = -1
     Вызываю EditorControl c ECTL_SELECT и устанавливаю EditorSelect.BlockStartLine = -1
     (подразумевается текущая строка, как это часто принято). Конкретно для этой операции
     в энциклопедии не указано, что -1 можно употребить. Но это работает (внешне).
     Но это, похоже, приводит к тому, что следующий вызов EditorControl с ECTL_GETINFO
     дает BlockStartLine = -1, и вот это уже неожиданно для остального кода, который
     к этому не готов.
     Даже если EditorSelect.BlockStartLine = -1 недопустимо, ECTL_GETINFO не должен
     возвращать некорретное значение BlockStartLine.

2. В mix.cpp::GetDiskSize не "__int64", но "unsigned __int64"

svs 13.03.2007 20:10:37 +0300 - build 2205

1. GetDiskSize (mix.cpp) чудил на терабайтных томах. Там вообще какой-то странный алгоритм
   был...

2. Macro: +"N=playmacro(S)" - "проиграть" строку в макросе
          +"S=waitkey(N)"   - ждать клавишу (вернет строковое представление клавиши,
                              или пусто по таймауту)

3. В связи с п.2 у функции GetInputRecord появился второй параметр (чтобы не вызывать повторно
   макросы из макросов, т.к. нам нужна всего лишь реальная клавиша)
   + у WaitKey() тоже есть параметр - таймаут в ms

4. Небольшие заделы для SERVICEREGION (Editor)


t-rex 12.03.2007 19:56:02 +0200 - build 2204

1. Изменилась логика наследования в раскраске, теперь от того кто следующий
   наследуется всё кроме прозрачных элементов. А также добавил кнопочку "Make transparent".

2. В фильрах "панели" если выбраны несколько фильтров то делается AND.

3. Добавил текст в заголовке меню фильтров для описания D?,D-,D+.


warp 03.03.2007 00:54:00 +0300 - build 2203

1. Элементы диалога типа DI_LISTBOX не ловили клик мышью в DN_MOUSECLICK
   отличный от FROM_LEFT_1ST_BUTTON_PRESSED.


svs 26.02.2007 10:38:45 +0300 - build 2202

1. Символ '^' после буквы режима сортировки показывает включенный режим
   "Show selected first"

2. Bug: Если одновременно указать несколько /v и /e, но из ФАРа не выйдем.
   На будущее - имеет смысл проработать вариант для стандалоне редактора/вьювера,
   но с неколькими открытыми файлами.

3. В FileEditor немного подсократил количество параметров.

4. Shift-F4 Ctrl-Y Enter на панели плагина матерится будет.
   (пока затычка...)

5. Был такой вот флаг FFILEEDIT_ISNEWFILE - нафига? - не помню.
   Убрал. Если "всплывет" - полечим.

6. Добавил EF_SERVICEREGION. Пка зарезервировано.

7. DIF_NOTCVTUSERCONTROL доступен всем.


t-rex 25.02.2007 06:45:48 +0200 - build 2201

1. Добавил фильтры в пометку файлов.


warp 25.02.2007 02:38:00 +0300 - build 2200

1. Поправил еще глюков с отрисовкой елки. Заодно сделал показ частичной елки
   в панели.


warp 12.02.2007 12:35:00 +0300 - build 2199

1. Вторая попытка исправить ситуацию с неправильно выставленной папкой в
   в ситуации, когда IsModulePlugin вернул FALSE. Предыдущая была какая-то
   идиотская. Будем надеяться, что работает, я так ситуацию до конца и не
   повторил.


t-rex 12.02.2007 04:44:25 +0200 - 2198

1. Сделал везде где должно быть virtual функции.

2. Удалил ещё нескольно ненужных файлов.

3. Исправил баг с падением при вводе таба в режиме EXPAND_NEWTABS.


svs 07.02.2007 18:29:07 +0300 - build 2197

1. Макро:
    APanel.ColumnCount - активная панель:  количество колонок
    PPanel.ColumnCount - пассивная панель: количество колонок

2. Правило "Panel\ShellRightLeftArrowsRule":REG_DWORD
    <ER>
    Нынешнее FAR'овское поведение ближе к NC/VC, чем предлагаемое.
    Единственная разница - в NC при пустой командной строке в режиме
    панели в одну колонку Left/Right просто игнорируются. Я же решил
    применить их к панели, чтобы не пропадали зря. При непустой
    командной строке FAR работает аналогично NC и VC. Как мне кажется,
    менять это поведение значит идти в разрез с многолетними привычками
    пользователей. Да и пользы от Left/Right в одноколоночной панели
    немного. Почти те же PgUp/PgDn.
    </ER>


   "ShellRightLeftArrowsRule":REG_DWORD
    Параметр "ShellRightLeftArrowsRule" с типом DWORD позволяет управлять
    поведением стрелок влево/вправо (как на основной, так и на дополнительной
    клавиатуре).
    Значения:
      0 - поведение как у 1.70: если командная строка непуста, то клавиши
          Left/Right и Num4/Num6 действуют по-разному в зависимости от
          режима панели: если имена файлов отображаются в несколько колонок
          (по умолчанию режимы 2 и 3), то команды вправо/влево применяются
          к панели (как и при пустой командной строке); а если имена файлов
          отображаются в одну колонку (по умолчанию все остальные режимы),
          то команды вправо/влево применяются к командной строке.
      1 - клавиши Left/Right и Num4/Num6 при включённой панели всегда
          применяются только к ней, независимо от содержимого командной
          строки и режима панели.
          Примечание: в командной строке есть CtrlD/CtrlS.
    По умолчанию значение = 0.


t-rex 07.02.2007 01:06:56 +0200 - 2196

1. Разные мелочи по теме фильтров.


t-rex 05.02.2007 17:01:41 +0200 - 2195

1. Алгоритмическое завершение фильтров панели - будем показывать тока те
   выбранные авто фильтры (для которых нету файлов на панели) которые
   выбраны в области текущего меню.

2. Партия хэлпа от Самлюкова. Плюс анг перевод и исправления от меня.


warp 05.02.2007 16:27:00 +0300 - 2194

1. Тот самый веселый баг с неудалением FolderTree с экрана. Как оно работало
   раньше - неизвестно, видимо по причине другого бага.

2. Сделал кое-где в классах правильное виртуальное наследование методов.


t-rex 04.02.2007 23:42:28 +0200 - 2193

1. Если диалог был во весь экран то фар мог падать при рисовании тени.

2. Раскраска и группы сортировки имеют один пункт в меню F9.

3. Немного обновил хэлп.


t-rex 04.02.2007 19:14:21 +0200 - 2192

1. Если плагин бы вызван по префиксу то до и после его вызова ком-строка обнулялась.
   Убрал обнуление после запуска так как плагин мог установить ком строку во время работы.
   При запуске из usermenu ком-строка как и раньше восстанавливается и так вроде должно быть.


t-rex 04.02.2007 16:21:16 +0200 - 2191

1. Компактизация диалога фильтров.

2. Раскраска символа пометки.

3. [ ] Continue processing для настроек раскраски.
   Если есть прозрачные цвета и [x] то ищем дальше.

4. Объединение групп сортировки с раскраской и вообще новый дизайн меню раскраски.
   В реестре всё хранится так чтоб была совместимость со старыми фарами.
   Файлы grpsort.cpp и grpsort.hpp удалены.

5. Дизайн меню раскраски как меню фильтров панели.

6. В меню фильтров панели функционал Ctrl-F изменен так что теперь Ctrl-F работает
   как тригер для текущего меню на разрешение или запрет фильтровать папки.
   Статус тригера виден в заголовке меню - D+ - папки не фильтруются, D? - папки фильтруются.
   По дефолту D+ - т.е. как и в старых фарах.

7. В меню фильтров панели теперь всегда есть пустая строка после юзер-фильтров.

8. Shift-<Grey -> в меню фильтров панели также сбрасывает статус тригера фильтрации папок в D+.
   Shift-BS как и было сбрасывает только пометки.


t-rex 02.02.2007 19:09:42 +0200 - 2190

1. Для DI_TEXT если заданы по человечески X1 и X2 то не будем выводить больше текста чем заданно.

2. Диалог настройки цвета в режиме с настройкой прозрачности теперь выглядит красивей.

3. Сделал хоткеи в диалоге фильтра.


t-rex 01.02.2007 03:05:40 +0200 - 2189

1. Оптимизация проверки непопадания под фильтр (FileFilterParams::FileInFilter)
   для фильтров не только по маске. Теперь в тысячи процентов быстрее.

svs 31.01.2007 19:14:14 +0300 - build 2188

1. После 2174 всплыла бага, судя по всему старая.
   Пропадал курсор после Shift-F7
   http://forum.farmanager.com/viewtopic.php?t=2399
   подробности в REMINDER

t-rex 30.01.2007 21:47:23 +0200 - 2187

1. В диалоге настроек фильтра для настройки цвета передавал фигню вместо самого цвета.


t-rex 30.01.2007 20:34:37 +0200 - 2186

1. Фиксы в диалоге фильтров.

2. Меню настройки цветов перерисовывает панели чтоб отражались прозрачные цвета.

3. Продолжаю продвигать код с в сторону настройки цветов для символа пометки.

4. FCTL_GETUSERSCREEN - сбрасывает UserBuffer на экран.
   Теперь плагины могу эмулировать запуск программ в фаре используя
   FCTL_GETUSERSCREEN и FCTL_SETUSERSCREEN.
   Заодно исправлен баг в FCTL_SETUSERSCREEN который съедал последнюю строчку
   при выводе в Ctrl-O.
   Ну и для правильной работы FCTL_GETUSERSCREEN при первом запуске фара, добавил
   выставления курсора перед сохранением первичного UserBuffer в ControlObject::Init().


warp 30.01.2007 20:19:00 +0300 - 2185

1. Привет из 1.8 - удалил все это бессмысленное виртуальное наследование классов.
   Унаследовал классы как положено, уменьшил размер .exe файла на 9кб.


t-rex 29.01.2007 02:53:12 +0200 - 2184

1. Довёл прозрачность в раскраске до логического финала - если в конце всё ещё есть
   прозрачные цвета то берутся дефолтные цвета фара. А также пофиксил глюк когда для
   прозрачного цвета брался чёрный цвет вместо дефолтного когда оригинальный цвет был
   black on black.

2. Переделал немного структуру хранящую раскраску для удобной работы с ней а также сделал
   заготовку для раскраски символа пометки.

3. Новый экспериментальный вид меню фильтров панели.
   По идеи хочу сделать все меню похожим образом и централизовано.

4. Вернул Ctrl-R в меню раскраски и оптимизировал его.

5. Вернул обработку %PATHEXT% фильтрам.


t-rex 28.01.2007 05:59:14 +0200 - 2183

1. Доделал сохранение в реестр для раскраски - осталось только CtrlR доделать.
   И вообще вроде как зафиналил работу с реестром во всех местах где используются
   фильтры и сделал так чтоб обновления фара прошло прозрачно для тех кто использует
   старые версии. Только в панельных фильтрах нету полной прозрачности но пользовательские
   фильтры загрузятся без проблем.

2. Группы сортировок это теперь тоже фильтры - полная реализация.
   А также теперь группы сортировок могу работать на папки - сделано так что папки
   все ровно всегда сверху но сортируются по группам между собой.

3. По мотивам fargroupwiki добавил опциональную прозрачность цветам и символу пометки в раскраске
   файлов. Реализация по моему очень удачная так как код ну супер простой и нет конфликтов со
   старыми настройками.
   Прозрачными могут быть цвета текста, фона и символ пометки.
   Прозрачность она дополнительна к существующим настройками а не вместо них.

   Алгоритм прозрачности вот такой:
   0. выставляем дефолтные цвета (чёрный на чёрном) + прозрачность
   1. ищем подходящий фильтр
   2. если нашли, считываем настройки раскраски, если нет то 5
   3. применяем настройки только к прозрачным элементам
   4. если всё ещё есть прозрачные элементы то назад в 1
   5. сбрасываем прозрачность если такая ещё есть - тут выходит
      что прозрачные элементы будут иметь такие настройки как
      последний подошедший фильтр (даже если там тоже была прозрачность).

   пример чтоб было более понятно:
   скажем есть такие пункты раскраски
   1. *.exe - у которого выставлены все цвета и стоит пустой прозрачный символ пометки
   2. * - атрибут RO - символ !
   3. * - атрибут H - символ .

   значит что выйдет - RO exe файл будет цвета exe файлов и будет иметь символ '!',
   H exe файл будет цвета exe файлов и будет иметь символ '.',
   все другие exe файлы будут цвета exe файлов и без символа.
   А также любые RO файлы будут иметь символ '!' а любые H файлы символ '.'.
   Надеюсь так более понятно.

4. В файл REMINDER записал первичный набросок API фильтров.
   Но с этим спешить не стоит, надо сначала устаканить код фильтров.


t-rex 27.01.2007 05:52:31 +0200 - 2182

1. Теперь раскраска файлов это тоже фильтры :)
   Ещё не доделано до конца (нет сохранения в реестр) но решил закомитить
   пока не поломал всё окончательно.

2. Добавил пару хотекеев в меню фильтров:
   CtrlF - для пометки фильтра папок
   BackSpace - снимает пометку
   ShiftBackSpace - как и ShiftGrey- снимает пометку у всех фильтров

   А также чекбокс "Match file mask(s)" теперь по дефолту включен в диалоге фильтра.

3. Класс FileFilterParams который и является самим фильтром вынесен в отдельные файлы
   filefilterparams.?pp так как он теперь будет использоваться в нескольких местах.
   Этот класс теперь также хранит настройки раскраски (во всяком случае пока я
   не разберусь как красиво сделать это через наследование).
   Диалог фильтров и раскраски это теперь один диалог который подстраивает себя соответственно.

4. В array.hpp добавлен новый шаблонный класс TPointerArray для базовой работы
   с массивом объектов. Он же используется теперь во всех местах где нужны фильтры.

5. Исправил мэйк для GCC.

6. Уря! Убил последние коменты. И удалил dummy.cpp.


svs 26.01.2007 16:35:13 +0300 - build 2181

1. Добавлен флаг DIF_SEPARATORUSER. Пока "внутри", т.к. в процессе...
   (подробнее в REMINDER)

2. Проблема с сепараторами, когда указаны ВСЕ координаты (из форума)
   пересчитаем правильные размеры.

3. В SysLog вместо пвсевдографики (вертикальная черта) ставим обычный '|'

4. Очередная порция убиения комментов.


t-rex 26.01.2007 01:24:46 +0200 - 2180

1. Ещё пару фиксов для фильтра.


svs 25.01.2007 13:16:27 +0300 - build 2179

1. В обработчике DefDlgProc для события DN_BTNCLICK не учитывался флаг DIF_BTNNOCLOSE

2. Траблы с надписями в кейбаре (редактор, вьювер).
   Теперь между MXXXXF1 и MXXXXF12 не должно быть добавочных... типа MXXXXF1DOS
   Такова специфика кода.

3. Для элемента DI_VTEXT добавлена обработка флагов:
    DIF_CENTERGROUP - (не уверен, надо проверить),
    DIF_SEPARATOR
    DIF_SEPARATOR2
    DIF_SHOWAMPERSAND

4. В обработчике флага DIF_CENTERTEXT трабла. Если был указан сепаратор, этот флаг
   и координата X (отличная от -1, т.е. полные координаты), то... сепаратор
   затирался...
   В общем DIF_CENTERTEXT в сочетании с DIF_SEPARATOR сам центрует строку.


t-rex 25.01.2007 07:14:19 +0200 - 2178

1. Снова фильтр - авто фильтры они только для файлов, папки не должны к ним подходить.


t-rex 25.01.2007 00:55:06 +0200 - 2177

1. Исправил пару багов с фильтром и доработал правильное сохранение в реестр.


t-rex 24.01.2007 23:18:17 +0200 - 2176

1. Соединил все виды фильтров (панели, копир и поиск) в одну сущность
   имеющую функционал всех прошлых фильтров вместе.

   Удобность работы с фильтром ещё не доработана до конца.
   На сей момент настройки меню фильтров независимы для каждого места
   откуда это меню может вызываться (панели, копир, поиск).

   Убрал файлы filter.* - теперь всё в filefilter.*.

2. Заодно исправлен баг из за которого в меню фильтров не сохранялись
   настройки для авто-фильтров но есть небольшой прикол - теперь маски
   авто-фильтра которые помечены в одной из областей работы фильтра
   показываются в меню фильтров во всех областях.
   Думаю может давать им другое имя если такой маски нет в панели.

3. Также исправлен Mantis#202 как побочный эффект.

4. На панелях можно фильтровать папки. Надо бы разобраться с копиром ещё.

5. Изменил в батниках имя файла куда сохраняется вывод компайлера чтоб у него
   не было окончания и все такие файлы шли на панели вместе.


svs 24.01.2007 18:57:20 +0300 - build 2175

1. Уточнение DlgEdit. Все же будем наследовать от ScreenObject

2. dlgedit?.pp - в досовой кодировке были

3. ScreenObject::GetPosition стала виртуальной.
   Возможно еще нужны уточнения по виртуальности функций...


svs 24.01.2007 16:32:45 +0300 - build 2174

1. убил немного комментов

2. везде, где встречается DialogData, прописаны Y2.
   Просьба - если делаете диалог, то Y2 обязательно заполняйте!

3. Переделка класса DlgEdit. Теперь он ни от кого не наследуется, но держт на борту
   2 ссылки - на Edit и Editor.
   Плюс - необходимый набор функций.
   В диалоге это один объект, по сути - два (но этот объект для диалога, так что...)

4. небольшая заготовка в usermenu под DI_MEMOEDIT (в обычной жизни не используется)
   макрос PROJECT_DI_MEMOEDIT пока не юзабелен.


svs 18.01.2007 22:11:48 +0300 - build 2173

1. Ля... ну никак нельзя заниматься работй и ФАРом (явно "работа" лишняя :-)
   Мать мать мать...  Снова кейбар.
   Ну естественно нужно не на "" заменять, а просто, согласно писанию, тупо
   пропускать установку лейба....
   в 1.8x это исправлено.

2. когда в Message не используется диалог, но применяется MSG_WARNING,
   ...цвета кривые :-(
   (по наводке warp&t-rex)
   в 1.8x это исправлено.

3. убил немного комментов


svs 18.01.2007 20:53:52 +0300 - build 2172

1. Упс... пропустил гол в предыдущем матче ;-(
   (нет проверки на NULL)

2. Бага. Вылечил. Визуальная бага. Старая бага.
   стоим в каталоге, где есть диз-файл
   Ctrl-L Tab  - перешли на инфо-панель
   Alt-F? (для противоположной панели) и дальше на тот диск,
          в каталоге которого нету diz`а
   Видим, что кейбар не обновился (Tab Tab - обновление прошло)

svs 18.01.2007 17:54:23 +0300 - build 2171

0. Пересмотр кода кейбаров... выкинул кучу кода.

1. Закончим с кейбаром в FolderTree (он у нас от Frame, так пусть по
   человече себя ведет, хотя бы как хелп)

2. Так же попробуем избавится от SaveScreen в FolderTree

3. в конструкторе TreeList проинициируем  SaveListData, иначе несколько
   раз Alt-F10 Esc и мы упали при освобождении памяти.

4. удалим немного комметов

5. Сейчас MKBFolderTreeXXX - всего несколько, имеет лис смысл разворачивать
   по всем клавишам (пусть даже они будут пустыми...) или как?
   Т.е. - делать как у всех объктов, юзающих кейбар или оставить так?


warp 16.01.2007 10:15:00 +0300 - build 2170

1. Не глядя поправил ситуацию с неправильно выставленной папкой в
   в ситуации, когда IsModulePlugin вернул FALSE.


t-rex 12.01.2007 21:52:01 +0200 - build 2169

1. Не посылался EE_CLOSE для ?New file?.
   Теперь EE_CLOSE посылается всегда если послался EE_READ чтоб
   небыло утечек памяти в плагинах.


t-rex 12.01.2007 16:38:51 +0200 - build 2168

1. !$! не работал по назначению.


t-rex 10.01.2007 15:11:17 +0200 - build 2167

1. Ещё немного x64.


svs 10.01.2007 14:43:36 +0300 - build

1. Без билда. Касаемо логирования.
   Добавлена _MCODE_ToName

warp 08.01.2007 21:45:00 +0300 - build 2166

1. Ужесточена проверка на наличие hotplug устройства. Проверяем, не
   ждет устройство извлечения.

svs 08.01.2007 11:46:54 +0300 - build 2165

1. Ctrl-A в архиве на каталоге - все опции атрибутов помчеены.


svs 08.01.2007 00:01:11 +0300 - build

1. Без билда. Восстановление возможности дебажной компиляции под VC 6
   Для компиляции понадобятся файлы cfg.h и cfgmgr32.h (из DDK)

   На сейчас следующее состояние
   ("+" - компилится, "-" - нет, "*" - не пробовал, "?" - нафиг ненать)

               BCC/5.02  BCC/5.5  VC/6  VC/2003  VC/2005  GCC
   Release        *?       +?      *?     +        *       *
   Release/64     *?       *?      *?     +        *       *
   Debug          +        +?      +      -        *       *
   Debug/64       *?       *?      -?     -        *       *

   (это я пробовал в своем окружении - усли у кого есть что добавить...)

2. Изменен scripts/mkdep.awk - не учитывался objlog для дебажной версии.


svs 07.01.2007 12:40:55 +0300 - build 2164

1. Изменен формат функции ScreeObject::VMProcess - новые параметры
   Возможно потом нужно будет еще несколько уточнений вводить, но на
   сейчас (для Help.XXXX) вполне достаточно.


t-rex 05.01.2007 17:57:39 +0200 - build 2163

1. Вернул назад прошлые изменения. Валя, ещё раз такое сделаешь, убью.
   Или ты делаешь этот хренов класс или удаляешь нафиг эту фичу вообще.


svs 05.01.2007 16:41:08 +0300 - build 2162

1. Про "поймаю Валю" :-)
   Пока сделаем так. По хорошему нужна отдельные методы у класса Help для
   получения необходимых данных...

t-rex 04.01.2007 11:19:01 +0200 - build 2161

1. Убрал всевозможные ворнинги связанные с x64 и заодно подправил пару мест
   (или я раньше пропустил или кто то уже успел нагадить).
   Включил показ x64 ворнингов для x64 билда - люди, перед тем как вы комитите свои
   изменения, соберите x64 версию и посмотрите на ворнинги - если есть и вы не знаете
   как правильно их решить то стучите ко мне (главное не уберите ворнинг оставив баг).

   Остались несколько ворнингов которые показывают на баг внесенный новыми макросами для
   хэлпа - буду решать когда поймаю Валю.

2. Удалил ClevMutex.hpp из за ненадобности и из за x64 несовместимости.


svs 27.12.2006 18:34:59 +0300 - build 2160

1. Macro: + новых слова:
    Help.FileName - имя просматриваемого файла помощи
    Help.Topic    - просматриваемый топик
    Help.SelTopic - топик, который сейчас выделен

2. Попутно бадья нашлась при формировании топика:
   Shift-F2, а дальше путешествуем по топикам.
   в итоге получаем кучу слешей в конце StackDate.HelpPath
   Решение - удалим все конечные слеши и добавляем единственный.

3. У DeleteEndSlash новый параметр - удалить ли _ВСЕ_ концевые слеши.
   по умолчание "неа, тока один от конца строки".

4. В WindowInfo для Help`а теперь заполням Name - полный путь к файлу.


svs 20.12.2006 17:12:10 +0300 - build 2159

1. Полумера, решения проблемы с выходом по ".." из юниководового каталога.
   а) позиционирование на каталого не происходит
   б) "cd .." матерится, но выходит.

svs 20.12.2006 15:26:33 +0300 - build 2158

1. Откат Mantis#198. Здесь все веселее и веселее...
   Проблема в том, что пока ФАР не получит управление...

svs 15.12.2006 16:48:23 +0300 - build 2157

1. Mantis#255 - При вставке пути к файлу/папке по Ctrl+Alt+F последний слеш
                получается  не в ту сторону
   Пусть AddEndSlash сама определяет чьих слешей больше :-)
   (второй параметр не "\", а 0x00).

2. Mantis#254 - Падение при копировании файла с длинным путём из связи с
                коротким путём
   (выправляем RawConvertShortNameToLongName)

3. Пусть "mkdep.list.txt" будет именоваться как "mkdep.list"
   (он, гад такой все время попадает... под txt)

4. Mantis#198. Уточнение. В обчем тут такое дело...
   Есть у меня макрос "F11 ? 1 !".
   Здесь
   '?' - хоткей для "cdHelps"
   '1' - Context-dependent help
   '!' - Previous query
   Если раньше в консоли ничего не появлялось, а просто тупо появлялся гуевый
   хелп. То сейчас мелькает меню - открывается и закрывается.
   Посему пока просто учтем Mode==MACRO_DIALOG.
   Хмм пока это писал, увидел артефакты и в редакторе...
   Однозначно только MACRO_DIALOG учитываем (а там посмотрим - в смысле
   вернуть все взад...)

svs 15.12.2006 12:17:28 +0300 - build 2156

1. Mantis#198: проблема с прорисовкой сообщения при работе с макросом
   Изменил немного механих окончания работы макропоследовательности

2. Жука надыбал. В панеле дерева "Shift-F6 End 1" ФАР с грохоттом
   завалился.
   Некорректно была сработана функция TreeList::GetCurDir()

svs 14.12.2006 12:04:08 +0300 - build 2155

1. Mantis#218: Проблема с копированием файла в самого себя
   (это когда копируем файл "c:\a.txt" в "c:")
   [-] При копировании уничтожалось содержимое файла в корне диска, если в
       качестве приемника указывался этот самый диск (файл "C:\a.txt" копируем в "C:")

2. Поддержка колеса мыши в объекте выбора папок (копир)


svs 13.12.2006 12:31:57 +0300 - build 2154

1. Mantis#235: Не распознаётся zip-архив
   Хотел сначала подателя жалобы послать на... TechInfo#63 :-)
   Но, расположение требуемой сигнатуры этого архива (в сааамом конце файла)
   не укладывается в указанный диапазон - "Диапазон от 0x1000 до 0x80000".
   Здесь как раз бы 4метра указать, но...
   В общем снял органичение на верхний предел.
   Доку поправлю.


svs 12.12.2006 15:17:13 +0300 - build 2153

1. В FolderTree не отрабатывали мышиные правила для диалога (вне диалога).

2. Mantis#253 - Пропадание содержимого дерева папок
   [-] Пропадало содержимое дерева папок, если процесс перечитывания
       каталогов прерывался.
   Добавил TreeList::SaveState() и TreeList::RestoreState(). чтобы сохранить
   текущие значения кеша и списка каталогов дерева.

3. DMOUSEBUTTON_* перенесены из dialog.hpp в farconst.hpp

svs 07.12.2006 15:25:47 +0300 - build 2152

1. Вводим VSMFL_REDRAW для ViewerSetMode.Flags, ибо так правильнее будет.
   т.е. либо VCTL_SETMODE + VCTL_REDRAW, либо VCTL_SETMODE(VSMFL_REDRAW).

svs 06.12.2006 19:30:17 +0300 - build 2151

1. Класс FolderTree наследуется от Frame, что позволило вылечить древний баг с
   прорисовкой (F5 F10 F1 F5 F5 Esc - видим "грязь" на экране).
   Так же это изменение позволило добавить фичи:
   а) Alt-F9 (само получилось, т.к. Manager сам умеет перерисовывать все, что
      наследуется от Frame)
   б) F5 - распахнуть/вернуть окно поиска каталога (по аналогии с хелпом)

   Так же, конструктор претерпел некоторые изменения в параметрах.

   В хелпах в раздел "@FindFolder" добавлена инфа про F5 и Ctrl[-Shift]-Enter.
   В FarEng.hlf.m4 нужен перевод.

2. Небольшие правки plugins.cpp. Просьба не употреблять __try/__except. Для
   этого есть макросы TRY/EXCEPT, соответственно.

3. Добавлен файл README. Перечислены некоторые правила. Если кто-то вспомнит
   еще правила - писать в этот файл.


warp & t-rex 05.12.2006 03:09:38 +0300 - build 2150

1. Поправлена логика предыдущего изменения. Кэшированные плагины не проверяются
   на принадлежность плагинам, это лишнее.

2. Функция проверки на принадлежность плагинам приведена в соответствие с x64.

warp 05.12.2006 01:39:38 +0300 - build 2149

1. Изменена логика загрузки плагинов. Введена проверка на принадлежность
   плагинам до загрузки модуля. Теперь Far будет ругаться на невозможность
   загрузить плагин, только если он был признан таковым до загрузки и при
   этом LoadLibraryEx вернул _любую_ ошибку.

   [*] Изменена логика загрузки плагинов. Модуль проверяется на принадлежность
   плагинам до загрузки.

2. Исправлен .pas файл на предмет VSMT_XXXX

svs 01.12.2006 19:47:38 +0300 - build 2148

1. Замена в составе: ViewerMode.TypeWrap -> ViewerMode.WordWrap

2. Добавка в ViewerAPI - VCTL_SETMODE, enum VIEWER_SETMODE_TYPES, struct ViewerSetMode

3. В XXXControl добавлена проверка на вшивость с юзанием IsBadReadPtr()


svs 30.11.2006 09:21:52 +0300 - build 2147

1. При выключенных настройках [ ] Save file position [ ] Save bookmarks
   после открытия файла на редактирование курсор по умолчанию становится
   в конец первой строки.

svs 28.11.2006 12:37:14 +0300 - build 2146

1. Mantis#248: Открытие по ShiftF4 предыдущего редактируемого файла.


t-rex 25.11.2006 10:53:30 +0200 - build 2145

1. Дополнение к x64. В PluginStartupInfo и FarStandardFunctions
   Reserved заменены с DWORD на DWORD_PTR чтоб не терять свой смысл.
   Соответственно это изменение требует пересборки x64 плагинов!

2. Немного GCC. Почему вы упорно не используете _i64(NUMBER) вместо NUMBERi64?
   И _ui64(NUMBER) вместо NUMBERui64.


svs 23.11.2006 19:51:42 +0300 - build 2144

1. Macro: $AKey - клавиша, который вызвали данный макрос
   (небольшой задел на будущее)

2. Возможность компиляции 1.7x под BCC


t-rex 23.11.2006 08:24:11 +0200 - build 2143

1. При удалении пустой строки или соединении двух строк при помощи DEL или BS выставлялись
   неправильные символы конца строки для "новой" строки.


t-rex 21.11.2006 18:13:55 +0200 - build 2142

1. Входим в эру 64-бит (ждём юникод :)

   Главные изменения: (надо будет обновить Енц.)
     DlgProc: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     SendDlgMessage: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     DefDlgProc: long Param2 -> LONG_PTR Param2 и возвращает LONG_PTR вместо long
     DialogEx: long Param -> LONG_PTR Param
     FarMenuItemEx: DWORD UserData -> DWORD_PTR UserData
     PluginPanelItem: DWORD UserData -> DWORD_PTR UserData
     AdvControl: возвращает INT_PTR вместо int
     OpenPlugin: int Item -> INT_PTR Item
   А также в execute.cpp добавлено определение 64-bit GUI прог.

   После некоторых экспериментов было выведено что выравнивание должно быть 8 для 64-bit версии.
   Обновил Far.mak и добавил vc.build.debug.64.bat и vc.build.release.64.bat которые используют
   custom.vc.debug.64.bat и custom.vc.release.64.bat соответственно.
   Мой custom.vc.release.64.bat содержит следующее:
   call "I:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\SetEnv.Cmd" /X64

   Единственное что ещё не доделано до конца это SEH - кто у нас в этом шарит?


svs 20.11.2006 16:37:26 +0300 - build 2141

1. Editor - copy/paste, блин.


t-rex 18.11.2006 23:23:58 +0200

1. без билда, обновил инклюды и скрипт генерации оных чтоб в них выводилась версия фара.


svs 17.11.2006 23:09:05 +0300 - build 2140

1. Бага предыдущего патча. В конце файла появлялся 0x00
   при повторном открытии редактора.

2. Mantis#139 - Нарушения с концами строк при Отмене

3. + Edit::GetEOL()

4. У Editor::AddUndoData новый параметр - пусть Undo помнит EOL!

5. Небольшие правки в mkfar.mak


svs 16.11.2006 23:03:47 +0300 - build 2139

1. EditList удален. Next/Prev теперь принадлежать классу Edit

2. Однообразные куски кода по добавлению строки в редакторе
   преобразованы в функции AddString и CreateString.

svs 13.11.2006 20:08:25 +0300 - build 2138

1. Добавлена функция FAR_GetFileSize (по аналогии с 1.80)

2. Wipe теперь "умеет" файлы > 2Gb

3. Заголовочные комменты в сорцах выносим в отдельный каталог.


svs 07.11.2006 21:33:42 +0300 -

1. без билда добавлен tee.exe с коррекцией vc.build.debug.bat и
   vc.build.release.bat

warp 01.11.2006 02:56:09 +0300 - build 2137

1. Несколько ахтунговый фикс. До конца не проверил еще.
   [-] Cтрока префиксов плагина больше не ограничена 512 символами.

svs 10.10.2006 11:10:09 +0300 - build 2136

1. Macro: Area-коды разнесены. Теперь Condition имеет свои OpCode, а
   области - свои. Иначе в дампе макроса при логировании хрень.
   Для ньюсов ничего пистать ненадо.

svs 09.10.2006 12:08:32 +0300 - build 2135

1. Упоминание про Ctrl-Shift-Enter при быстром поиске (нужен перевод!)
   Mantis 244

2. FindFile: Зацикливается поиск при поиске подстроки на файле больше 2Gb
   Mantis 243

3. уточнение mkfar.mak - компиляция под BCC.


warp 05.10.2006 06:18:34 +0300 - build 2134

1. Вроде поправил ширину DIF_SEPARATOR для диалогов без рамки.

t-rex 27.09.2006 04:05:23 +0300 - build 2133

1. Ещё одно дополнение к фиксу "Падение при старте ФАРа, когда каталог недоступен".
   На пассивной панели открывался каталог без ".." вверху.

t-rex 27.09.2006 03:07:27 +0300

Косметика без билда.

1. Прошлый патч был совсем не в тему. Вернул как было и чтоб больше не было
   вопросов сделал два батника и изменил Far.mak:

   Эти батники на прямую не редактировать!!!!!!!!!
   Только для постоянных изменений для всех участников проекта.
   Читайте объяснение - всё продумано.

   --------------------
   vc.build.release.bat
   --------------------
   Этот батник собирает release версию фара с помощью VC и Far.mak.
   Батник заодно обновляет far.release.dep и языковые файлы.
   С запуском этого батника никогда не будут никаких проблем при сборке фара
   (кроме ошибок в самом коде :).
   Чтобы батник был универсальным и работал у всех без изменений он
   вызывает другой батник - custom.vc.release.bat - если такой есть.
   Этот (custom.vc.release.bat) батник вам надо создать самим так как он ваш
   личный и на SVN комитится не будет. В нём вы можете определять переменные
   среды компайлера и переопределять переменные среды которые используются
   для сборки фара в главном батнике.
   Например у меня он содержит:
   ---->8----
   @echo off
   call F:\lng\VC.Toolkit.2003\vcvars32.bat
   ----8<----

   ------------------
   vc.build.debug.bat
   ------------------
   Тоже что и vc.build.release.bat только собирает debug версию, обновляет
   far.debug.dep и вызывает custom.vc.debug.bat если такой есть.
   Пример custom.vc.debug.bat:
   ---->8----
   @echo off
   call F:\lng\VS98\Bin\VCVARS32.BAT
   set FAR_MSVCRT=/D FAR_MSVCRT
   set FARSYSLOG=-DSYSLOG_TREX %FARSYSLOG%
   ----8<----


svs 26.09.2006 10:52:00 +0300 -

Косметика без билда.

1. В mkdep.list.txt добавлены copyright.inc и farversion.inc, т.к. если сделать
   первый раз экспорт, а потом запустить компиляцию, то будет ошибка компиляции
   global.cpp, т.к.  ни copyright.inc ни farversion.inc еще нету.

   Так же исправлен scripts\mkdep.awk - учитывает расширение INC, т.е. как раз
   те самые файлы copyright.inc и farversion.inc, которые генерятся из *.m4.


t-rex 24.09.2006 17:21:44 +0300 - build 2132

1. Не влезали русские слова в диалог фильтра.

t-rex 23.09.2006 04:19:12 +0300 - build 2131

1. Дополнил Валин фикс на тему "Падение при старте ФАРа, когда каталог недоступен"
   а то выходила фигня если недоступный путь был например C:\a - фар открывал C: и
   делал это очень криво.

t-rex 23.09.2006 02:54:44 +0300 - build 2130

1. Починил вставку мусора в редакторе в висте при нажатие на Enter.
   В висте realloc на уменьшение не всегда (а может и никогда) ни возвращает тот же адрес.

2. Починил сборку GCC.

t-rex 23.09.2006 01:12:39 +0300 - build 2129

1. Новая система сборки как и в 1.80 для работы с SVN.

2. Начинаем писать changelog, я сделал себе макрос
   "t - r e x Space $Date \"%d.%m0.%Y %H:%M:%S %Z\" Enter"
   чтоб выводить заголовок changelog-а.
   Последующие логи надо писать сверху - т.е. файл будет идти хронологически снизу вверх.
   В changelog прошу писать в Win кодировке.
