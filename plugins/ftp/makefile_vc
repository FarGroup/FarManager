!if exists(../make_vc_defs)
!include ../make_vc_defs
!endif

NAME = FarFtp
DOCS = FtpEng.hlf FtpRus.hlf FtpEng.lng FtpRus.lng TechInfo.reg TechInfo_rus.reg FtpCmds.txt FtpCmds_rus.txt Notes.txt Notes_rus.txt

NEEDDEFLIB=1
NEEDENTRY=1
EXCLUDECRT=1

FSTDLIB=$(OBJDIR)\FsdLib.lib
OBJLIB=$(OBJDIR)\LibObj
LIBSRC=FStdLib\FARStdLib

LINK_DEP=$(FSTDLIB)

FLLLIST = DirList Progress
!ifndef INSTALL
FLLLIST = $(FLLLIST) Notify
!endif
##########

LINK_OBJS = \
$(OBJDIR)\ftp_AskOver.obj $(OBJDIR)\ftp_Cfg.obj $(OBJDIR)\ftp_CmdLine.obj \
$(OBJDIR)\ftp_cnDownload.obj $(OBJDIR)\ftp_cnInit.obj \
$(OBJDIR)\ftp_cnUpload.obj $(OBJDIR)\ftp_Connect.obj \
$(OBJDIR)\ftp_ConnectCmds.obj $(OBJDIR)\ftp_ConnectIO.obj \
$(OBJDIR)\ftp_ConnectMain.obj $(OBJDIR)\ftp_ConnectNB.obj \
$(OBJDIR)\ftp_ConnectSock.obj $(OBJDIR)\ftp_DeleteFile.obj \
$(OBJDIR)\ftp_EnumHost.obj $(OBJDIR)\ftp_Event.obj $(OBJDIR)\ftp_FAR.obj \
$(OBJDIR)\ftp_FGet.obj $(OBJDIR)\ftp_FileList.obj $(OBJDIR)\ftp_FPut.obj \
$(OBJDIR)\ftp_Ftp.obj $(OBJDIR)\ftp_FtpAPI.obj $(OBJDIR)\ftp_FTPBlock.obj \
$(OBJDIR)\ftp_FTPConnect.obj $(OBJDIR)\ftp_FtpDlg.obj \
$(OBJDIR)\ftp_FTPHost.obj $(OBJDIR)\ftp_fUtils.obj \
$(OBJDIR)\ftp_GetOpenInfo.obj $(OBJDIR)\ftp_HGet.obj $(OBJDIR)\ftp_HPut.obj \
$(OBJDIR)\ftp_JM.obj $(OBJDIR)\ftp_Key.obj $(OBJDIR)\ftp_MakeDir.obj \
$(OBJDIR)\ftp_Mem.obj $(OBJDIR)\ftp_Mix.obj $(OBJDIR)\ftp_Plugin.obj \
$(OBJDIR)\ftp_SetDir.obj $(OBJDIR)\ftp_Shortcut.obj $(OBJDIR)\ftp_sock.obj \
$(OBJDIR)\ftp_Queque.obj $(OBJDIR)\ftp_Url.obj

##########

LIB_OBJS = \
$(OBJLIB)\fstd_Arg.obj $(OBJLIB)\fstd_asrt.obj $(OBJLIB)\fstd_cDialog.obj \
$(OBJLIB)\fstd_ClpS.obj $(OBJLIB)\fstd_crc32.obj $(OBJLIB)\fstd_Dbg.obj \
$(OBJLIB)\fstd_Dialog.obj $(OBJLIB)\fstd_Dlg.obj $(OBJLIB)\fstd_Editor.obj \
$(OBJLIB)\fstd_err.obj $(OBJLIB)\fstd_exSCAT.obj $(OBJLIB)\fstd_exSCHC.obj \
$(OBJLIB)\fstd_exSCMP.obj $(OBJLIB)\fstd_exSCPY.obj $(OBJLIB)\fstd_exSNCH.obj \
$(OBJLIB)\fstd_exSPCH.obj $(OBJLIB)\fstd_exSPS.obj $(OBJLIB)\fstd_ilist.obj \
$(OBJLIB)\fstd_INProc.obj $(OBJLIB)\fstd_log.obj \
$(OBJLIB)\fstd_mems.obj $(OBJLIB)\fstd_memh.obj $(OBJLIB)\fstd_menu.obj \
$(OBJLIB)\fstd_mesg.obj $(OBJLIB)\fstd_mklog.obj $(OBJLIB)\fstd_Msg.obj \
$(OBJLIB)\fstd_Multiline.obj $(OBJLIB)\fstd_Patt.obj $(OBJLIB)\fstd_per.obj \
$(OBJLIB)\fstd_plg.obj $(OBJLIB)\fstd_RegCh.obj $(OBJLIB)\fstd_RegCp.obj \
$(OBJLIB)\fstd_RegCr.obj $(OBJLIB)\fstd_RegDl.obj $(OBJLIB)\fstd_RegDla.obj \
$(OBJLIB)\fstd_RegGB.obj $(OBJLIB)\fstd_RegGI.obj $(OBJLIB)\fstd_RegOp.obj \
$(OBJLIB)\fstd_RegRn.obj $(OBJLIB)\fstd_RegSB.obj $(OBJLIB)\fstd_RegSC.obj \
$(OBJLIB)\fstd_RegSI.obj $(OBJLIB)\fstd_SCol.obj $(OBJLIB)\fstd_scr.obj \
$(OBJLIB)\fstd_String.obj $(OBJLIB)\fstd_stdlibCS.obj \
$(OBJLIB)\fstd_stdlibME.obj $(OBJLIB)\fstd_stdlibSP.obj \
$(OBJLIB)\fstd_stdlibST.obj $(OBJLIB)\fstd_SText.obj \
$(OBJLIB)\fstd_exit.obj $(OBJLIB)\fstd_HotKey.obj $(OBJLIB)\fstd_Con.obj \
$(OBJLIB)\fstd_FMsg.obj $(OBJLIB)\fstd_CharDraw.obj $(OBJLIB)\fstd_OEM.obj \
$(OBJLIB)\fstd_Utils.obj $(OBJLIB)\fstd_FUtils.obj


DEP_HDR=ftp_int.h FStdLib\fstdlib.h lib/ftp_Plugin.h ftp_Plugins.h ftp_Cfg.h \
ftp_JM.h ftp_var.h ftp_Connect.h ftp_FtpAPI.h ftp_Ftp.h

##########

USERCPP=/I.\FStdLib /D__NOMEM__=1 /D__HEAP_MEMORY__=1 /D__USEASSERT__=1 \
        /D__NOVCL__=1 /D_CONSOLE=1
!ifdef DEBUG
USERCPP=$(USERCPP) /D__FILELOG__=1 /D__DEBUG__=1
!endif

All: dirs libdir

!include ..\makefile_vc_def_inc

LIBS=$(FSTDLIB) $(LIBS) wsock32.lib winmm.lib

!include ..\makefile_vc_target_inc

All: fstdlib flls

fstdlib: $(FSTDLIB)

$(LINK_OBJS) : $(DEP_HDR)

##########
.PHONY: libdir
libdir:
	@if not exist "$(OBJLIB)\$(NULL)" mkdir "$(OBJLIB)"

$(FSTDLIB): $(LIB_OBJS)
!ifndef __MAKE__
	@$(LIBR) /OUT:$@ @<<
$(LIB_OBJS)
<<
!else
	@$(LIBR) /OUT:$@ @&&<
$(LIB_OBJS)
<
!endif

!ifndef __MAKE__
{$(LIBSRC)}.cpp{$(OBJLIB)}.obj::
	$(CC) @<<
	$(CFLAGS_NO) /Fo$(OBJLIB)\ $<
<<
!else
{$(LIBSRC)}.cpp{$(OBJLIB)}.obj:
	@$(CC) $(CFLAGS_NO) /Fo$(OBJLIB)\ { $< } 
!endif

$(RES): ftpversion.hpp

##########
flls: $(FLLLIST)

!include ../makefile_vc_getmode

!ifdef __MAKE__
.PHONY: $(FLLLIST)
!else
FICTIVE=_fictive_
_fictive_:
!endif

$(FLLLIST): $(FICTIVE)
!ifndef INSTALL
	$(MAKE) /nologo /f makefile_vc_fll $(_MKDO_)FLL=$@ $(_MDEFS)
!else
	$(MAKE) /nologo /f makefile_vc_fll $(_MKDO_)FLL=$@ $(_MDEFS) INSTALL=$(INSTALL)
!endif

